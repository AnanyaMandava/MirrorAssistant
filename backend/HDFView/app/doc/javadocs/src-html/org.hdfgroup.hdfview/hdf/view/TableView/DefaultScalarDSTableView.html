<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>Source code</title>
<meta name="description" content="source: module: org.hdfgroup.hdfview, package: hdf.view.TableView, class: DefaultScalarDSTableView">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line.1">/*****************************************************************************</span>
<span class="source-line-no">002</span><span id="line.2"> * Copyright by The HDF Group.                                               *</span>
<span class="source-line-no">003</span><span id="line.3"> * Copyright by the Board of Trustees of the University of Illinois.         *</span>
<span class="source-line-no">004</span><span id="line.4"> * All rights reserved.                                                      *</span>
<span class="source-line-no">005</span><span id="line.5"> *                                                                           *</span>
<span class="source-line-no">006</span><span id="line.6"> * This file is part of the HDF Java Products distribution.                  *</span>
<span class="source-line-no">007</span><span id="line.7"> * The full copyright notice, including terms governing use, modification,   *</span>
<span class="source-line-no">008</span><span id="line.8"> * and redistribution, is contained in the files COPYING and Copyright.html. *</span>
<span class="source-line-no">009</span><span id="line.9"> * COPYING can be found at the root of the source code distribution tree.    *</span>
<span class="source-line-no">010</span><span id="line.10"> * Or, see https://support.hdfgroup.org/products/licenses.html               *</span>
<span class="source-line-no">011</span><span id="line.11"> * If you do not have access to either file, you may request a copy from     *</span>
<span class="source-line-no">012</span><span id="line.12"> * help@hdfgroup.org.                                                        *</span>
<span class="source-line-no">013</span><span id="line.13"> ****************************************************************************/</span>
<span class="source-line-no">014</span><span id="line.14"></span>
<span class="source-line-no">015</span><span id="line.15">package hdf.view.TableView;</span>
<span class="source-line-no">016</span><span id="line.16"></span>
<span class="source-line-no">017</span><span id="line.17">import java.lang.reflect.Array;</span>
<span class="source-line-no">018</span><span id="line.18">import java.lang.reflect.Constructor;</span>
<span class="source-line-no">019</span><span id="line.19">import java.math.BigInteger;</span>
<span class="source-line-no">020</span><span id="line.20">import java.util.HashMap;</span>
<span class="source-line-no">021</span><span id="line.21">import java.util.Iterator;</span>
<span class="source-line-no">022</span><span id="line.22">import java.util.LinkedHashSet;</span>
<span class="source-line-no">023</span><span id="line.23">import java.util.Set;</span>
<span class="source-line-no">024</span><span id="line.24">import java.util.StringTokenizer;</span>
<span class="source-line-no">025</span><span id="line.25"></span>
<span class="source-line-no">026</span><span id="line.26">import org.eclipse.nebula.widgets.nattable.NatTable;</span>
<span class="source-line-no">027</span><span id="line.27">import org.eclipse.nebula.widgets.nattable.command.VisualRefreshCommand;</span>
<span class="source-line-no">028</span><span id="line.28">import org.eclipse.nebula.widgets.nattable.config.DefaultNatTableStyleConfiguration;</span>
<span class="source-line-no">029</span><span id="line.29">import org.eclipse.nebula.widgets.nattable.config.EditableRule;</span>
<span class="source-line-no">030</span><span id="line.30">import org.eclipse.nebula.widgets.nattable.config.IEditableRule;</span>
<span class="source-line-no">031</span><span id="line.31">import org.eclipse.nebula.widgets.nattable.coordinate.PositionCoordinate;</span>
<span class="source-line-no">032</span><span id="line.32">import org.eclipse.nebula.widgets.nattable.coordinate.Range;</span>
<span class="source-line-no">033</span><span id="line.33">import org.eclipse.nebula.widgets.nattable.data.IDataProvider;</span>
<span class="source-line-no">034</span><span id="line.34">import org.eclipse.nebula.widgets.nattable.grid.data.DefaultCornerDataProvider;</span>
<span class="source-line-no">035</span><span id="line.35">import org.eclipse.nebula.widgets.nattable.grid.layer.ColumnHeaderLayer;</span>
<span class="source-line-no">036</span><span id="line.36">import org.eclipse.nebula.widgets.nattable.grid.layer.CornerLayer;</span>
<span class="source-line-no">037</span><span id="line.37">import org.eclipse.nebula.widgets.nattable.grid.layer.GridLayer;</span>
<span class="source-line-no">038</span><span id="line.38">import org.eclipse.nebula.widgets.nattable.grid.layer.RowHeaderLayer;</span>
<span class="source-line-no">039</span><span id="line.39">import org.eclipse.nebula.widgets.nattable.layer.DataLayer;</span>
<span class="source-line-no">040</span><span id="line.40">import org.eclipse.nebula.widgets.nattable.layer.ILayer;</span>
<span class="source-line-no">041</span><span id="line.41">import org.eclipse.nebula.widgets.nattable.layer.ILayerListener;</span>
<span class="source-line-no">042</span><span id="line.42">import org.eclipse.nebula.widgets.nattable.layer.event.ILayerEvent;</span>
<span class="source-line-no">043</span><span id="line.43">import org.eclipse.nebula.widgets.nattable.selection.SelectionLayer;</span>
<span class="source-line-no">044</span><span id="line.44">import org.eclipse.nebula.widgets.nattable.selection.command.SelectCellCommand;</span>
<span class="source-line-no">045</span><span id="line.45">import org.eclipse.nebula.widgets.nattable.selection.event.CellSelectionEvent;</span>
<span class="source-line-no">046</span><span id="line.46">import org.eclipse.nebula.widgets.nattable.viewport.ViewportLayer;</span>
<span class="source-line-no">047</span><span id="line.47">import org.eclipse.swt.SWT;</span>
<span class="source-line-no">048</span><span id="line.48">import org.eclipse.swt.custom.ScrolledComposite;</span>
<span class="source-line-no">049</span><span id="line.49">import org.eclipse.swt.events.DisposeEvent;</span>
<span class="source-line-no">050</span><span id="line.50">import org.eclipse.swt.events.DisposeListener;</span>
<span class="source-line-no">051</span><span id="line.51">import org.eclipse.swt.events.SelectionAdapter;</span>
<span class="source-line-no">052</span><span id="line.52">import org.eclipse.swt.events.SelectionEvent;</span>
<span class="source-line-no">053</span><span id="line.53">import org.eclipse.swt.widgets.Composite;</span>
<span class="source-line-no">054</span><span id="line.54">import org.eclipse.swt.widgets.Menu;</span>
<span class="source-line-no">055</span><span id="line.55">import org.eclipse.swt.widgets.MenuItem;</span>
<span class="source-line-no">056</span><span id="line.56">import org.eclipse.swt.widgets.Shell;</span>
<span class="source-line-no">057</span><span id="line.57"></span>
<span class="source-line-no">058</span><span id="line.58">import hdf.object.DataFormat;</span>
<span class="source-line-no">059</span><span id="line.59">import hdf.object.Dataset;</span>
<span class="source-line-no">060</span><span id="line.60">import hdf.object.Datatype;</span>
<span class="source-line-no">061</span><span id="line.61">import hdf.object.FileFormat;</span>
<span class="source-line-no">062</span><span id="line.62">import hdf.object.HObject;</span>
<span class="source-line-no">063</span><span id="line.63">import hdf.object.ScalarDS;</span>
<span class="source-line-no">064</span><span id="line.64">import hdf.object.Utils;</span>
<span class="source-line-no">065</span><span id="line.65">import hdf.view.HDFView;</span>
<span class="source-line-no">066</span><span id="line.66">import hdf.view.Tools;</span>
<span class="source-line-no">067</span><span id="line.67">import hdf.view.ViewProperties;</span>
<span class="source-line-no">068</span><span id="line.68">import hdf.view.DataView.DataViewManager;</span>
<span class="source-line-no">069</span><span id="line.69">import hdf.view.dialog.InputDialog;</span>
<span class="source-line-no">070</span><span id="line.70"></span>
<span class="source-line-no">071</span><span id="line.71">public class DefaultScalarDSTableView extends DefaultBaseTableView implements TableView {</span>
<span class="source-line-no">072</span><span id="line.72"></span>
<span class="source-line-no">073</span><span id="line.73">    private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(DefaultScalarDSTableView.class);</span>
<span class="source-line-no">074</span><span id="line.74"></span>
<span class="source-line-no">075</span><span id="line.75">    /**</span>
<span class="source-line-no">076</span><span id="line.76">     * Constructs a ScalarDS TableView with no additional data properties.</span>
<span class="source-line-no">077</span><span id="line.77">     *</span>
<span class="source-line-no">078</span><span id="line.78">     * @param theView</span>
<span class="source-line-no">079</span><span id="line.79">     *            the main HDFView.</span>
<span class="source-line-no">080</span><span id="line.80">     */</span>
<span class="source-line-no">081</span><span id="line.81">    public DefaultScalarDSTableView(DataViewManager theView) {</span>
<span class="source-line-no">082</span><span id="line.82">        this(theView, null);</span>
<span class="source-line-no">083</span><span id="line.83">    }</span>
<span class="source-line-no">084</span><span id="line.84"></span>
<span class="source-line-no">085</span><span id="line.85">    /**</span>
<span class="source-line-no">086</span><span id="line.86">     * Constructs a ScalarDS TableView with the specified data properties.</span>
<span class="source-line-no">087</span><span id="line.87">     *</span>
<span class="source-line-no">088</span><span id="line.88">     * @param theView</span>
<span class="source-line-no">089</span><span id="line.89">     *            the main HDFView.</span>
<span class="source-line-no">090</span><span id="line.90">     *</span>
<span class="source-line-no">091</span><span id="line.91">     * @param dataPropertiesMap</span>
<span class="source-line-no">092</span><span id="line.92">     *            the properties on how to show the data. The map is used to allow</span>
<span class="source-line-no">093</span><span id="line.93">     *            applications to pass properties on how to display the data, such</span>
<span class="source-line-no">094</span><span id="line.94">     *            as: transposing data, showing data as characters, applying a</span>
<span class="source-line-no">095</span><span id="line.95">     *            bitmask, and etc. Predefined keys are listed at</span>
<span class="source-line-no">096</span><span id="line.96">     *            ViewProperties.DATA_VIEW_KEY.</span>
<span class="source-line-no">097</span><span id="line.97">     */</span>
<span class="source-line-no">098</span><span id="line.98">    @SuppressWarnings("rawtypes")</span>
<span class="source-line-no">099</span><span id="line.99">    public DefaultScalarDSTableView(DataViewManager theView, HashMap dataPropertiesMap) {</span>
<span class="source-line-no">100</span><span id="line.100">        super(theView, dataPropertiesMap);</span>
<span class="source-line-no">101</span><span id="line.101"></span>
<span class="source-line-no">102</span><span id="line.102">        if (!shell.isDisposed()) {</span>
<span class="source-line-no">103</span><span id="line.103">            shell.setImage(dataObject.getDatatype().isText() ? ViewProperties.getTextIcon() : ViewProperties.getDatasetIcon());</span>
<span class="source-line-no">104</span><span id="line.104"></span>
<span class="source-line-no">105</span><span id="line.105">            shell.addDisposeListener(new DisposeListener() {</span>
<span class="source-line-no">106</span><span id="line.106">                @Override</span>
<span class="source-line-no">107</span><span id="line.107">                public void widgetDisposed(DisposeEvent e) {</span>
<span class="source-line-no">108</span><span id="line.108">                    if (dataObject instanceof ScalarDS) {</span>
<span class="source-line-no">109</span><span id="line.109">                        ScalarDS ds = (ScalarDS) dataObject;</span>
<span class="source-line-no">110</span><span id="line.110"></span>
<span class="source-line-no">111</span><span id="line.111">                        /*</span>
<span class="source-line-no">112</span><span id="line.112">                         * Reload the data when it is displayed next time because the display type</span>
<span class="source-line-no">113</span><span id="line.113">                         * (table or image) may be different.</span>
<span class="source-line-no">114</span><span id="line.114">                         */</span>
<span class="source-line-no">115</span><span id="line.115">                        if (ds.isImage()) ds.clearData();</span>
<span class="source-line-no">116</span><span id="line.116">                    }</span>
<span class="source-line-no">117</span><span id="line.117">                }</span>
<span class="source-line-no">118</span><span id="line.118">            });</span>
<span class="source-line-no">119</span><span id="line.119"></span>
<span class="source-line-no">120</span><span id="line.120">            viewer.addDataView(this);</span>
<span class="source-line-no">121</span><span id="line.121"></span>
<span class="source-line-no">122</span><span id="line.122">            shell.open();</span>
<span class="source-line-no">123</span><span id="line.123">        }</span>
<span class="source-line-no">124</span><span id="line.124">    }</span>
<span class="source-line-no">125</span><span id="line.125"></span>
<span class="source-line-no">126</span><span id="line.126">    @Override</span>
<span class="source-line-no">127</span><span id="line.127">    protected void loadData(DataFormat dataObject) throws Exception {</span>
<span class="source-line-no">128</span><span id="line.128">        super.loadData(dataObject);</span>
<span class="source-line-no">129</span><span id="line.129"></span>
<span class="source-line-no">130</span><span id="line.130">        try {</span>
<span class="source-line-no">131</span><span id="line.131">            if (Tools.applyBitmask(dataValue, bitmask, bitmaskOP)) {</span>
<span class="source-line-no">132</span><span id="line.132">                isReadOnly = true;</span>
<span class="source-line-no">133</span><span id="line.133">                String opName = "Bits ";</span>
<span class="source-line-no">134</span><span id="line.134"></span>
<span class="source-line-no">135</span><span id="line.135">                if (bitmaskOP == ViewProperties.BITMASK_OP.AND)</span>
<span class="source-line-no">136</span><span id="line.136">                    opName = "Bitwise AND ";</span>
<span class="source-line-no">137</span><span id="line.137"></span>
<span class="source-line-no">138</span><span id="line.138">                String title = indexBaseGroup.getText();</span>
<span class="source-line-no">139</span><span id="line.139">                title += ", " + opName + bitmask;</span>
<span class="source-line-no">140</span><span id="line.140">                indexBaseGroup.setText(title);</span>
<span class="source-line-no">141</span><span id="line.141">            }</span>
<span class="source-line-no">142</span><span id="line.142"></span>
<span class="source-line-no">143</span><span id="line.143">            dataObject.convertFromUnsignedC();</span>
<span class="source-line-no">144</span><span id="line.144"></span>
<span class="source-line-no">145</span><span id="line.145">            dataValue = dataObject.getData();</span>
<span class="source-line-no">146</span><span id="line.146">        }</span>
<span class="source-line-no">147</span><span id="line.147">        catch (Exception ex) {</span>
<span class="source-line-no">148</span><span id="line.148">            log.debug("loadData(): ", ex);</span>
<span class="source-line-no">149</span><span id="line.149">            dataValue = null;</span>
<span class="source-line-no">150</span><span id="line.150">            throw ex;</span>
<span class="source-line-no">151</span><span id="line.151">        }</span>
<span class="source-line-no">152</span><span id="line.152"></span>
<span class="source-line-no">153</span><span id="line.153">        if (dataValue == null) {</span>
<span class="source-line-no">154</span><span id="line.154">            log.debug("loadData(): data value is null");</span>
<span class="source-line-no">155</span><span id="line.155">            throw new RuntimeException("data value is null");</span>
<span class="source-line-no">156</span><span id="line.156">        }</span>
<span class="source-line-no">157</span><span id="line.157"></span>
<span class="source-line-no">158</span><span id="line.158">        fillValue = dataObject.getFillValue();</span>
<span class="source-line-no">159</span><span id="line.159">        log.trace("loadData(): fillValue={}", fillValue);</span>
<span class="source-line-no">160</span><span id="line.160"></span>
<span class="source-line-no">161</span><span id="line.161">        char runtimeTypeClass = Utils.getJavaObjectRuntimeClass(dataValue);</span>
<span class="source-line-no">162</span><span id="line.162">        log.trace("loadData(): cName={} runtimeTypeClass={}", dataValue.getClass().getName(), runtimeTypeClass);</span>
<span class="source-line-no">163</span><span id="line.163"></span>
<span class="source-line-no">164</span><span id="line.164">        /*</span>
<span class="source-line-no">165</span><span id="line.165">         * Convert numerical data into character data; only possible cases are byte[]</span>
<span class="source-line-no">166</span><span id="line.166">         * and short[] (converted from unsigned byte)</span>
<span class="source-line-no">167</span><span id="line.167">         */</span>
<span class="source-line-no">168</span><span id="line.168">        if (isDisplayTypeChar &amp;&amp; ((runtimeTypeClass == 'B') || (runtimeTypeClass == 'S'))) {</span>
<span class="source-line-no">169</span><span id="line.169">            int n = Array.getLength(dataValue);</span>
<span class="source-line-no">170</span><span id="line.170">            char[] charData = new char[n];</span>
<span class="source-line-no">171</span><span id="line.171">            for (int i = 0; i &lt; n; i++) {</span>
<span class="source-line-no">172</span><span id="line.172">                if (runtimeTypeClass == 'B') {</span>
<span class="source-line-no">173</span><span id="line.173">                    charData[i] = (char) Array.getByte(dataValue, i);</span>
<span class="source-line-no">174</span><span id="line.174">                }</span>
<span class="source-line-no">175</span><span id="line.175">                else if (runtimeTypeClass == 'S') {</span>
<span class="source-line-no">176</span><span id="line.176">                    charData[i] = (char) Array.getShort(dataValue, i);</span>
<span class="source-line-no">177</span><span id="line.177">                }</span>
<span class="source-line-no">178</span><span id="line.178">            }</span>
<span class="source-line-no">179</span><span id="line.179"></span>
<span class="source-line-no">180</span><span id="line.180">            dataValue = charData;</span>
<span class="source-line-no">181</span><span id="line.181">        }</span>
<span class="source-line-no">182</span><span id="line.182">        else if ((runtimeTypeClass == 'B') &amp;&amp; dataObject.getDatatype().isArray()) {</span>
<span class="source-line-no">183</span><span id="line.183">            Datatype baseType = dataObject.getDatatype().getDatatypeBase();</span>
<span class="source-line-no">184</span><span id="line.184">            if (baseType.isString()) {</span>
<span class="source-line-no">185</span><span id="line.185">                dataValue = Dataset.byteToString((byte[]) dataValue, (int) baseType.getDatatypeSize());</span>
<span class="source-line-no">186</span><span id="line.186">            }</span>
<span class="source-line-no">187</span><span id="line.187">        }</span>
<span class="source-line-no">188</span><span id="line.188">    }</span>
<span class="source-line-no">189</span><span id="line.189"></span>
<span class="source-line-no">190</span><span id="line.190">    /**</span>
<span class="source-line-no">191</span><span id="line.191">     * Creates the menubar for the Shell.</span>
<span class="source-line-no">192</span><span id="line.192">     */</span>
<span class="source-line-no">193</span><span id="line.193">    @Override</span>
<span class="source-line-no">194</span><span id="line.194">    protected Menu createMenuBar(final Shell theShell) {</span>
<span class="source-line-no">195</span><span id="line.195">        Menu baseMenu = super.createMenuBar(theShell);</span>
<span class="source-line-no">196</span><span id="line.196">        MenuItem[] baseMenuItems = baseMenu.getItems();</span>
<span class="source-line-no">197</span><span id="line.197">        MenuItem item = null;</span>
<span class="source-line-no">198</span><span id="line.198"></span>
<span class="source-line-no">199</span><span id="line.199">        /*****************************************************************************</span>
<span class="source-line-no">200</span><span id="line.200">         *                                                                           *</span>
<span class="source-line-no">201</span><span id="line.201">         * Add in a few MenuItems for importing/exporting data from/to binary files. *</span>
<span class="source-line-no">202</span><span id="line.202">         *                                                                           *</span>
<span class="source-line-no">203</span><span id="line.203">         *****************************************************************************/</span>
<span class="source-line-no">204</span><span id="line.204"></span>
<span class="source-line-no">205</span><span id="line.205">        MenuItem importExportMenuItem = null;</span>
<span class="source-line-no">206</span><span id="line.206">        for (int i = 0; i &lt; baseMenuItems.length; i++)</span>
<span class="source-line-no">207</span><span id="line.207">            if (baseMenuItems[i].getText().equals("&amp;Import/Export Data"))</span>
<span class="source-line-no">208</span><span id="line.208">                importExportMenuItem = baseMenuItems[i];</span>
<span class="source-line-no">209</span><span id="line.209"></span>
<span class="source-line-no">210</span><span id="line.210">        if (importExportMenuItem != null) {</span>
<span class="source-line-no">211</span><span id="line.211">            Menu importExportMenu = importExportMenuItem.getMenu();</span>
<span class="source-line-no">212</span><span id="line.212">            MenuItem[] importExportMenuItems = importExportMenu.getItems();</span>
<span class="source-line-no">213</span><span id="line.213"></span>
<span class="source-line-no">214</span><span id="line.214">            for (int i = 0; i &lt; importExportMenuItems.length; i++)</span>
<span class="source-line-no">215</span><span id="line.215">                if (importExportMenuItems[i].getText().equals("Export Data to"))</span>
<span class="source-line-no">216</span><span id="line.216">                    item = importExportMenuItems[i];</span>
<span class="source-line-no">217</span><span id="line.217"></span>
<span class="source-line-no">218</span><span id="line.218">            if (item != null) {</span>
<span class="source-line-no">219</span><span id="line.219">                Menu exportMenu = item.getMenu();</span>
<span class="source-line-no">220</span><span id="line.220"></span>
<span class="source-line-no">221</span><span id="line.221">                MenuItem exportAsBinaryMenuItem = new MenuItem(exportMenu, SWT.CASCADE);</span>
<span class="source-line-no">222</span><span id="line.222">                exportAsBinaryMenuItem.setText("Binary File");</span>
<span class="source-line-no">223</span><span id="line.223"></span>
<span class="source-line-no">224</span><span id="line.224">                Menu exportAsBinaryMenu = new Menu(exportAsBinaryMenuItem);</span>
<span class="source-line-no">225</span><span id="line.225">                exportAsBinaryMenuItem.setMenu(exportAsBinaryMenu);</span>
<span class="source-line-no">226</span><span id="line.226"></span>
<span class="source-line-no">227</span><span id="line.227">                item = new MenuItem(exportAsBinaryMenu, SWT.PUSH);</span>
<span class="source-line-no">228</span><span id="line.228">                item.setText("Native Order");</span>
<span class="source-line-no">229</span><span id="line.229">                item.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">230</span><span id="line.230">                    @Override</span>
<span class="source-line-no">231</span><span id="line.231">                    public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">232</span><span id="line.232">                        binaryOrder = 1;</span>
<span class="source-line-no">233</span><span id="line.233"></span>
<span class="source-line-no">234</span><span id="line.234">                        try {</span>
<span class="source-line-no">235</span><span id="line.235">                            saveAsBinary();</span>
<span class="source-line-no">236</span><span id="line.236">                        }</span>
<span class="source-line-no">237</span><span id="line.237">                        catch (Exception ex) {</span>
<span class="source-line-no">238</span><span id="line.238">                            theShell.getDisplay().beep();</span>
<span class="source-line-no">239</span><span id="line.239">                            Tools.showError(theShell, "Export", ex.getMessage());</span>
<span class="source-line-no">240</span><span id="line.240">                        }</span>
<span class="source-line-no">241</span><span id="line.241">                    }</span>
<span class="source-line-no">242</span><span id="line.242">                });</span>
<span class="source-line-no">243</span><span id="line.243"></span>
<span class="source-line-no">244</span><span id="line.244">                item = new MenuItem(exportAsBinaryMenu, SWT.PUSH);</span>
<span class="source-line-no">245</span><span id="line.245">                item.setText("Little Endian");</span>
<span class="source-line-no">246</span><span id="line.246">                item.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">247</span><span id="line.247">                    @Override</span>
<span class="source-line-no">248</span><span id="line.248">                    public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">249</span><span id="line.249">                        binaryOrder = 2;</span>
<span class="source-line-no">250</span><span id="line.250"></span>
<span class="source-line-no">251</span><span id="line.251">                        try {</span>
<span class="source-line-no">252</span><span id="line.252">                            saveAsBinary();</span>
<span class="source-line-no">253</span><span id="line.253">                        }</span>
<span class="source-line-no">254</span><span id="line.254">                        catch (Exception ex) {</span>
<span class="source-line-no">255</span><span id="line.255">                            theShell.getDisplay().beep();</span>
<span class="source-line-no">256</span><span id="line.256">                            Tools.showError(theShell, "Export", ex.getMessage());</span>
<span class="source-line-no">257</span><span id="line.257">                        }</span>
<span class="source-line-no">258</span><span id="line.258">                    }</span>
<span class="source-line-no">259</span><span id="line.259">                });</span>
<span class="source-line-no">260</span><span id="line.260"></span>
<span class="source-line-no">261</span><span id="line.261">                item = new MenuItem(exportAsBinaryMenu, SWT.PUSH);</span>
<span class="source-line-no">262</span><span id="line.262">                item.setText("Big Endian");</span>
<span class="source-line-no">263</span><span id="line.263">                item.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">264</span><span id="line.264">                    @Override</span>
<span class="source-line-no">265</span><span id="line.265">                    public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">266</span><span id="line.266">                        binaryOrder = 3;</span>
<span class="source-line-no">267</span><span id="line.267"></span>
<span class="source-line-no">268</span><span id="line.268">                        try {</span>
<span class="source-line-no">269</span><span id="line.269">                            saveAsBinary();</span>
<span class="source-line-no">270</span><span id="line.270">                        }</span>
<span class="source-line-no">271</span><span id="line.271">                        catch (Exception ex) {</span>
<span class="source-line-no">272</span><span id="line.272">                            theShell.getDisplay().beep();</span>
<span class="source-line-no">273</span><span id="line.273">                            Tools.showError(theShell, "Export", ex.getMessage());</span>
<span class="source-line-no">274</span><span id="line.274">                        }</span>
<span class="source-line-no">275</span><span id="line.275">                    }</span>
<span class="source-line-no">276</span><span id="line.276">                });</span>
<span class="source-line-no">277</span><span id="line.277">            }</span>
<span class="source-line-no">278</span><span id="line.278"></span>
<span class="source-line-no">279</span><span id="line.279">            item = null;</span>
<span class="source-line-no">280</span><span id="line.280">            for (int i = 0; i &lt; importExportMenuItems.length; i++)</span>
<span class="source-line-no">281</span><span id="line.281">                if (importExportMenuItems[i].getText().equals("Import Data from"))</span>
<span class="source-line-no">282</span><span id="line.282">                    item = importExportMenuItems[i];</span>
<span class="source-line-no">283</span><span id="line.283"></span>
<span class="source-line-no">284</span><span id="line.284">            if (item != null) {</span>
<span class="source-line-no">285</span><span id="line.285">                Menu importMenu = item.getMenu();</span>
<span class="source-line-no">286</span><span id="line.286"></span>
<span class="source-line-no">287</span><span id="line.287">                MenuItem importAsBinaryMenuItem = new MenuItem(importMenu, SWT.CASCADE);</span>
<span class="source-line-no">288</span><span id="line.288">                importAsBinaryMenuItem.setText("Binary File");</span>
<span class="source-line-no">289</span><span id="line.289"></span>
<span class="source-line-no">290</span><span id="line.290">                Menu importAsBinaryMenu = new Menu(importAsBinaryMenuItem);</span>
<span class="source-line-no">291</span><span id="line.291">                importAsBinaryMenuItem.setMenu(importAsBinaryMenu);</span>
<span class="source-line-no">292</span><span id="line.292"></span>
<span class="source-line-no">293</span><span id="line.293">                item = new MenuItem(importAsBinaryMenu, SWT.PUSH);</span>
<span class="source-line-no">294</span><span id="line.294">                item.setText("Native Order");</span>
<span class="source-line-no">295</span><span id="line.295">                item.setEnabled(!isReadOnly);</span>
<span class="source-line-no">296</span><span id="line.296">                item.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">297</span><span id="line.297">                    @Override</span>
<span class="source-line-no">298</span><span id="line.298">                    public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">299</span><span id="line.299">                        binaryOrder = 1;</span>
<span class="source-line-no">300</span><span id="line.300"></span>
<span class="source-line-no">301</span><span id="line.301">                        try {</span>
<span class="source-line-no">302</span><span id="line.302">                            importBinaryData();</span>
<span class="source-line-no">303</span><span id="line.303">                        }</span>
<span class="source-line-no">304</span><span id="line.304">                        catch (Exception ex) {</span>
<span class="source-line-no">305</span><span id="line.305">                            Tools.showError(theShell, "Import", ex.getMessage());</span>
<span class="source-line-no">306</span><span id="line.306">                        }</span>
<span class="source-line-no">307</span><span id="line.307">                    }</span>
<span class="source-line-no">308</span><span id="line.308">                });</span>
<span class="source-line-no">309</span><span id="line.309"></span>
<span class="source-line-no">310</span><span id="line.310">                item = new MenuItem(importAsBinaryMenu, SWT.PUSH);</span>
<span class="source-line-no">311</span><span id="line.311">                item.setText("Little Endian");</span>
<span class="source-line-no">312</span><span id="line.312">                item.setEnabled(!isReadOnly);</span>
<span class="source-line-no">313</span><span id="line.313">                item.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">314</span><span id="line.314">                    @Override</span>
<span class="source-line-no">315</span><span id="line.315">                    public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">316</span><span id="line.316">                        binaryOrder = 2;</span>
<span class="source-line-no">317</span><span id="line.317"></span>
<span class="source-line-no">318</span><span id="line.318">                        try {</span>
<span class="source-line-no">319</span><span id="line.319">                            importBinaryData();</span>
<span class="source-line-no">320</span><span id="line.320">                        }</span>
<span class="source-line-no">321</span><span id="line.321">                        catch (Exception ex) {</span>
<span class="source-line-no">322</span><span id="line.322">                            Tools.showError(theShell, "Import", ex.getMessage());</span>
<span class="source-line-no">323</span><span id="line.323">                        }</span>
<span class="source-line-no">324</span><span id="line.324">                    }</span>
<span class="source-line-no">325</span><span id="line.325">                });</span>
<span class="source-line-no">326</span><span id="line.326"></span>
<span class="source-line-no">327</span><span id="line.327">                item = new MenuItem(importAsBinaryMenu, SWT.PUSH);</span>
<span class="source-line-no">328</span><span id="line.328">                item.setText("Big Endian");</span>
<span class="source-line-no">329</span><span id="line.329">                item.setEnabled(!isReadOnly);</span>
<span class="source-line-no">330</span><span id="line.330">                item.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">331</span><span id="line.331">                    @Override</span>
<span class="source-line-no">332</span><span id="line.332">                    public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">333</span><span id="line.333">                        binaryOrder = 3;</span>
<span class="source-line-no">334</span><span id="line.334"></span>
<span class="source-line-no">335</span><span id="line.335">                        try {</span>
<span class="source-line-no">336</span><span id="line.336">                            importBinaryData();</span>
<span class="source-line-no">337</span><span id="line.337">                        }</span>
<span class="source-line-no">338</span><span id="line.338">                        catch (Exception ex) {</span>
<span class="source-line-no">339</span><span id="line.339">                            Tools.showError(theShell, "Import", ex.getMessage());</span>
<span class="source-line-no">340</span><span id="line.340">                        }</span>
<span class="source-line-no">341</span><span id="line.341">                    }</span>
<span class="source-line-no">342</span><span id="line.342">                });</span>
<span class="source-line-no">343</span><span id="line.343">            }</span>
<span class="source-line-no">344</span><span id="line.344"></span>
<span class="source-line-no">345</span><span id="line.345">            new MenuItem(importExportMenu, SWT.SEPARATOR);</span>
<span class="source-line-no">346</span><span id="line.346"></span>
<span class="source-line-no">347</span><span id="line.347">            checkFixedDataLength = new MenuItem(importExportMenu, SWT.CHECK);</span>
<span class="source-line-no">348</span><span id="line.348">            checkFixedDataLength.setText("Fixed Data Length");</span>
<span class="source-line-no">349</span><span id="line.349">            checkFixedDataLength.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">350</span><span id="line.350">                @Override</span>
<span class="source-line-no">351</span><span id="line.351">                public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">352</span><span id="line.352">                    if (!checkFixedDataLength.getSelection()) {</span>
<span class="source-line-no">353</span><span id="line.353">                        fixedDataLength = -1;</span>
<span class="source-line-no">354</span><span id="line.354">                        return;</span>
<span class="source-line-no">355</span><span id="line.355">                    }</span>
<span class="source-line-no">356</span><span id="line.356"></span>
<span class="source-line-no">357</span><span id="line.357">                    String str = new InputDialog(theShell, "",</span>
<span class="source-line-no">358</span><span id="line.358">                            "Enter fixed data length when importing text data\n\n"</span>
<span class="source-line-no">359</span><span id="line.359">                                    + "For example, for a text string of \"12345678\"\n\t\tenter 2,"</span>
<span class="source-line-no">360</span><span id="line.360">                                    + "the data will be 12, 34, 56, 78\n\t\tenter 4, the data will be" + "1234, 5678\n")</span>
<span class="source-line-no">361</span><span id="line.361">                            .open();</span>
<span class="source-line-no">362</span><span id="line.362"></span>
<span class="source-line-no">363</span><span id="line.363">                    if ((str == null) || (str.length() &lt; 1)) {</span>
<span class="source-line-no">364</span><span id="line.364">                        checkFixedDataLength.setSelection(false);</span>
<span class="source-line-no">365</span><span id="line.365">                        return;</span>
<span class="source-line-no">366</span><span id="line.366">                    }</span>
<span class="source-line-no">367</span><span id="line.367"></span>
<span class="source-line-no">368</span><span id="line.368">                    try {</span>
<span class="source-line-no">369</span><span id="line.369">                        fixedDataLength = Integer.parseInt(str);</span>
<span class="source-line-no">370</span><span id="line.370">                    }</span>
<span class="source-line-no">371</span><span id="line.371">                    catch (Exception ex) {</span>
<span class="source-line-no">372</span><span id="line.372">                        fixedDataLength = -1;</span>
<span class="source-line-no">373</span><span id="line.373">                    }</span>
<span class="source-line-no">374</span><span id="line.374"></span>
<span class="source-line-no">375</span><span id="line.375">                    if (fixedDataLength &lt; 1) {</span>
<span class="source-line-no">376</span><span id="line.376">                        checkFixedDataLength.setSelection(false);</span>
<span class="source-line-no">377</span><span id="line.377">                    }</span>
<span class="source-line-no">378</span><span id="line.378">                }</span>
<span class="source-line-no">379</span><span id="line.379">            });</span>
<span class="source-line-no">380</span><span id="line.380">        }</span>
<span class="source-line-no">381</span><span id="line.381"></span>
<span class="source-line-no">382</span><span id="line.382">        /*****************************************************************************************</span>
<span class="source-line-no">383</span><span id="line.383">         *                                                                                       *</span>
<span class="source-line-no">384</span><span id="line.384">         * Add a section for changing the way that data is displayed, e.g. as hexadecimal values *</span>
<span class="source-line-no">385</span><span id="line.385">         *                                                                                       *</span>
<span class="source-line-no">386</span><span id="line.386">         *****************************************************************************************/</span>
<span class="source-line-no">387</span><span id="line.387"></span>
<span class="source-line-no">388</span><span id="line.388">        MenuItem dataDisplayMenuItem = new MenuItem(baseMenu, SWT.CASCADE);</span>
<span class="source-line-no">389</span><span id="line.389">        dataDisplayMenuItem.setText("Data Display");</span>
<span class="source-line-no">390</span><span id="line.390"></span>
<span class="source-line-no">391</span><span id="line.391">        Menu dataDisplayMenu = new Menu(theShell, SWT.DROP_DOWN);</span>
<span class="source-line-no">392</span><span id="line.392">        dataDisplayMenuItem.setMenu(dataDisplayMenu);</span>
<span class="source-line-no">393</span><span id="line.393"></span>
<span class="source-line-no">394</span><span id="line.394">        checkScientificNotation = new MenuItem(dataDisplayMenu, SWT.CHECK);</span>
<span class="source-line-no">395</span><span id="line.395">        checkScientificNotation.setText("Show Scientific Notation");</span>
<span class="source-line-no">396</span><span id="line.396">        checkScientificNotation.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">397</span><span id="line.397">            @Override</span>
<span class="source-line-no">398</span><span id="line.398">            public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">399</span><span id="line.399">                if (checkScientificNotation.getSelection()) {</span>
<span class="source-line-no">400</span><span id="line.400">                    if (checkCustomNotation != null) checkCustomNotation.setSelection(false);</span>
<span class="source-line-no">401</span><span id="line.401">                    if (checkEnum != null) checkEnum.setSelection(false);</span>
<span class="source-line-no">402</span><span id="line.402">                    if (checkHex != null) checkHex.setSelection(false);</span>
<span class="source-line-no">403</span><span id="line.403">                    if (checkBin != null) checkBin.setSelection(false);</span>
<span class="source-line-no">404</span><span id="line.404"></span>
<span class="source-line-no">405</span><span id="line.405">                    numberFormat = scientificFormat;</span>
<span class="source-line-no">406</span><span id="line.406">                    showAsHex = false;</span>
<span class="source-line-no">407</span><span id="line.407">                    showAsBin = false;</span>
<span class="source-line-no">408</span><span id="line.408">                }</span>
<span class="source-line-no">409</span><span id="line.409">                else {</span>
<span class="source-line-no">410</span><span id="line.410">                    numberFormat = normalFormat;</span>
<span class="source-line-no">411</span><span id="line.411">                }</span>
<span class="source-line-no">412</span><span id="line.412"></span>
<span class="source-line-no">413</span><span id="line.413">                updateDataConversionSettings();</span>
<span class="source-line-no">414</span><span id="line.414"></span>
<span class="source-line-no">415</span><span id="line.415">                dataTable.doCommand(new VisualRefreshCommand());</span>
<span class="source-line-no">416</span><span id="line.416"></span>
<span class="source-line-no">417</span><span id="line.417">                PositionCoordinate lastSelectedCell = getSelectionLayer().getLastSelectedCellPosition();</span>
<span class="source-line-no">418</span><span id="line.418">                if (lastSelectedCell != null) {</span>
<span class="source-line-no">419</span><span id="line.419">                    /*</span>
<span class="source-line-no">420</span><span id="line.420">                     * Send down a cell selection event for the current cell to update the cell</span>
<span class="source-line-no">421</span><span id="line.421">                     * value labels</span>
<span class="source-line-no">422</span><span id="line.422">                     */</span>
<span class="source-line-no">423</span><span id="line.423">                    dataTable.doCommand(new SelectCellCommand(getSelectionLayer(), lastSelectedCell.columnPosition,</span>
<span class="source-line-no">424</span><span id="line.424">                            lastSelectedCell.rowPosition, false, false));</span>
<span class="source-line-no">425</span><span id="line.425">                }</span>
<span class="source-line-no">426</span><span id="line.426">            }</span>
<span class="source-line-no">427</span><span id="line.427">        });</span>
<span class="source-line-no">428</span><span id="line.428"></span>
<span class="source-line-no">429</span><span id="line.429">        checkCustomNotation = new MenuItem(dataDisplayMenu, SWT.CHECK);</span>
<span class="source-line-no">430</span><span id="line.430">        checkCustomNotation.setText("Show Custom Notation");</span>
<span class="source-line-no">431</span><span id="line.431">        checkCustomNotation.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">432</span><span id="line.432">            @Override</span>
<span class="source-line-no">433</span><span id="line.433">            public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">434</span><span id="line.434">                if (checkCustomNotation.getSelection()) {</span>
<span class="source-line-no">435</span><span id="line.435">                    if (checkScientificNotation != null) checkScientificNotation.setSelection(false);</span>
<span class="source-line-no">436</span><span id="line.436">                    if (checkEnum != null) checkEnum.setSelection(false);</span>
<span class="source-line-no">437</span><span id="line.437">                    if (checkHex != null) checkHex.setSelection(false);</span>
<span class="source-line-no">438</span><span id="line.438">                    if (checkBin != null) checkBin.setSelection(false);</span>
<span class="source-line-no">439</span><span id="line.439"></span>
<span class="source-line-no">440</span><span id="line.440">                    numberFormat = customFormat;</span>
<span class="source-line-no">441</span><span id="line.441">                    showAsHex = false;</span>
<span class="source-line-no">442</span><span id="line.442">                    showAsBin = false;</span>
<span class="source-line-no">443</span><span id="line.443">                }</span>
<span class="source-line-no">444</span><span id="line.444">                else {</span>
<span class="source-line-no">445</span><span id="line.445">                    numberFormat = normalFormat;</span>
<span class="source-line-no">446</span><span id="line.446">                }</span>
<span class="source-line-no">447</span><span id="line.447"></span>
<span class="source-line-no">448</span><span id="line.448">                updateDataConversionSettings();</span>
<span class="source-line-no">449</span><span id="line.449"></span>
<span class="source-line-no">450</span><span id="line.450">                dataTable.doCommand(new VisualRefreshCommand());</span>
<span class="source-line-no">451</span><span id="line.451"></span>
<span class="source-line-no">452</span><span id="line.452">                PositionCoordinate lastSelectedCell = getSelectionLayer().getLastSelectedCellPosition();</span>
<span class="source-line-no">453</span><span id="line.453">                if (lastSelectedCell != null) {</span>
<span class="source-line-no">454</span><span id="line.454">                    /*</span>
<span class="source-line-no">455</span><span id="line.455">                     * Send down a cell selection event for the current cell to update the cell</span>
<span class="source-line-no">456</span><span id="line.456">                     * value labels</span>
<span class="source-line-no">457</span><span id="line.457">                     */</span>
<span class="source-line-no">458</span><span id="line.458">                    dataTable.doCommand(new SelectCellCommand(getSelectionLayer(), lastSelectedCell.columnPosition,</span>
<span class="source-line-no">459</span><span id="line.459">                            lastSelectedCell.rowPosition, false, false));</span>
<span class="source-line-no">460</span><span id="line.460">                }</span>
<span class="source-line-no">461</span><span id="line.461">            }</span>
<span class="source-line-no">462</span><span id="line.462">        });</span>
<span class="source-line-no">463</span><span id="line.463"></span>
<span class="source-line-no">464</span><span id="line.464">        item = new MenuItem(dataDisplayMenu, SWT.PUSH);</span>
<span class="source-line-no">465</span><span id="line.465">        item.setText("Create custom notation");</span>
<span class="source-line-no">466</span><span id="line.466">        item.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">467</span><span id="line.467">            @Override</span>
<span class="source-line-no">468</span><span id="line.468">            public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">469</span><span id="line.469">                String msg = "Create number format by pattern \nINTEGER . FRACTION E EXPONENT\nusing # for optional digits and 0 for required digits"</span>
<span class="source-line-no">470</span><span id="line.470">                        + "\nwhere, INTEGER: the pattern for the integer part"</span>
<span class="source-line-no">471</span><span id="line.471">                        + "\n       FRACTION: the pattern for the fractional part"</span>
<span class="source-line-no">472</span><span id="line.472">                        + "\n       EXPONENT: the pattern for the exponent part" + "\n\nFor example, "</span>
<span class="source-line-no">473</span><span id="line.473">                        + "\n\t the normalized scientific notation format is \"#.0###E0##\""</span>
<span class="source-line-no">474</span><span id="line.474">                        + "\n\t to make the digits required \"0.00000E000\"\n\n";</span>
<span class="source-line-no">475</span><span id="line.475"></span>
<span class="source-line-no">476</span><span id="line.476">                String str = (new InputDialog(theShell, "Create a custom number format", msg, customFormat.toPattern()))</span>
<span class="source-line-no">477</span><span id="line.477">                        .open();</span>
<span class="source-line-no">478</span><span id="line.478"></span>
<span class="source-line-no">479</span><span id="line.479">                if ((str == null) || (str.length() &lt; 1)) {</span>
<span class="source-line-no">480</span><span id="line.480">                    return;</span>
<span class="source-line-no">481</span><span id="line.481">                }</span>
<span class="source-line-no">482</span><span id="line.482"></span>
<span class="source-line-no">483</span><span id="line.483">                try {</span>
<span class="source-line-no">484</span><span id="line.484">                    customFormat.applyPattern(str);</span>
<span class="source-line-no">485</span><span id="line.485">                }</span>
<span class="source-line-no">486</span><span id="line.486">                catch (Exception ex) {</span>
<span class="source-line-no">487</span><span id="line.487">                    log.debug("Invalid custom number notation format: {}:", str, ex);</span>
<span class="source-line-no">488</span><span id="line.488">                    Tools.showError(shell, "Create", "Invalid custom notation format " + str);</span>
<span class="source-line-no">489</span><span id="line.489">                }</span>
<span class="source-line-no">490</span><span id="line.490">            }</span>
<span class="source-line-no">491</span><span id="line.491">        });</span>
<span class="source-line-no">492</span><span id="line.492"></span>
<span class="source-line-no">493</span><span id="line.493">        char runtimeTypeClass = Utils.getJavaObjectRuntimeClass(dataValue);</span>
<span class="source-line-no">494</span><span id="line.494">        boolean isInt = (runtimeTypeClass == 'B' || runtimeTypeClass == 'S' || runtimeTypeClass == 'I'</span>
<span class="source-line-no">495</span><span id="line.495">                || runtimeTypeClass == 'J');</span>
<span class="source-line-no">496</span><span id="line.496"></span>
<span class="source-line-no">497</span><span id="line.497">        if (isInt || dataObject.getDatatype().isBitField() || dataObject.getDatatype().isOpaque()) {</span>
<span class="source-line-no">498</span><span id="line.498">            checkHex = new MenuItem(dataDisplayMenu, SWT.CHECK);</span>
<span class="source-line-no">499</span><span id="line.499">            checkHex.setText("Show Hexadecimal");</span>
<span class="source-line-no">500</span><span id="line.500">            checkHex.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">501</span><span id="line.501">                @Override</span>
<span class="source-line-no">502</span><span id="line.502">                public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">503</span><span id="line.503">                    showAsHex = checkHex.getSelection();</span>
<span class="source-line-no">504</span><span id="line.504">                    if (showAsHex) {</span>
<span class="source-line-no">505</span><span id="line.505">                        if (checkScientificNotation != null) checkScientificNotation.setSelection(false);</span>
<span class="source-line-no">506</span><span id="line.506">                        if (checkCustomNotation != null) checkCustomNotation.setSelection(false);</span>
<span class="source-line-no">507</span><span id="line.507">                        if (checkEnum != null) checkEnum.setSelection(false);</span>
<span class="source-line-no">508</span><span id="line.508">                        if (checkBin != null) checkBin.setSelection(false);</span>
<span class="source-line-no">509</span><span id="line.509"></span>
<span class="source-line-no">510</span><span id="line.510">                        showAsBin = false;</span>
<span class="source-line-no">511</span><span id="line.511">                        numberFormat = normalFormat;</span>
<span class="source-line-no">512</span><span id="line.512">                    }</span>
<span class="source-line-no">513</span><span id="line.513"></span>
<span class="source-line-no">514</span><span id="line.514">                    updateDataConversionSettings();</span>
<span class="source-line-no">515</span><span id="line.515"></span>
<span class="source-line-no">516</span><span id="line.516">                    dataTable.doCommand(new VisualRefreshCommand());</span>
<span class="source-line-no">517</span><span id="line.517"></span>
<span class="source-line-no">518</span><span id="line.518">                    PositionCoordinate lastSelectedCell = getSelectionLayer().getLastSelectedCellPosition();</span>
<span class="source-line-no">519</span><span id="line.519">                    if (lastSelectedCell != null) {</span>
<span class="source-line-no">520</span><span id="line.520">                        /*</span>
<span class="source-line-no">521</span><span id="line.521">                         * Send down a cell selection event for the current cell to update the cell</span>
<span class="source-line-no">522</span><span id="line.522">                         * value labels</span>
<span class="source-line-no">523</span><span id="line.523">                         */</span>
<span class="source-line-no">524</span><span id="line.524">                        dataTable.doCommand(new SelectCellCommand(getSelectionLayer(), lastSelectedCell.columnPosition,</span>
<span class="source-line-no">525</span><span id="line.525">                                lastSelectedCell.rowPosition, false, false));</span>
<span class="source-line-no">526</span><span id="line.526">                    }</span>
<span class="source-line-no">527</span><span id="line.527">                }</span>
<span class="source-line-no">528</span><span id="line.528">            });</span>
<span class="source-line-no">529</span><span id="line.529"></span>
<span class="source-line-no">530</span><span id="line.530">            checkBin = new MenuItem(dataDisplayMenu, SWT.CHECK);</span>
<span class="source-line-no">531</span><span id="line.531">            checkBin.setText("Show Binary");</span>
<span class="source-line-no">532</span><span id="line.532">            checkBin.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">533</span><span id="line.533">                @Override</span>
<span class="source-line-no">534</span><span id="line.534">                public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">535</span><span id="line.535">                    showAsBin = checkBin.getSelection();</span>
<span class="source-line-no">536</span><span id="line.536">                    if (showAsBin) {</span>
<span class="source-line-no">537</span><span id="line.537">                        if (checkScientificNotation != null) checkScientificNotation.setSelection(false);</span>
<span class="source-line-no">538</span><span id="line.538">                        if (checkCustomNotation != null) checkCustomNotation.setSelection(false);</span>
<span class="source-line-no">539</span><span id="line.539">                        if (checkEnum != null) checkEnum.setSelection(false);</span>
<span class="source-line-no">540</span><span id="line.540">                        if (checkHex != null) checkHex.setSelection(false);</span>
<span class="source-line-no">541</span><span id="line.541"></span>
<span class="source-line-no">542</span><span id="line.542">                        showAsHex = false;</span>
<span class="source-line-no">543</span><span id="line.543">                        numberFormat = normalFormat;</span>
<span class="source-line-no">544</span><span id="line.544">                    }</span>
<span class="source-line-no">545</span><span id="line.545"></span>
<span class="source-line-no">546</span><span id="line.546">                    updateDataConversionSettings();</span>
<span class="source-line-no">547</span><span id="line.547"></span>
<span class="source-line-no">548</span><span id="line.548">                    dataTable.doCommand(new VisualRefreshCommand());</span>
<span class="source-line-no">549</span><span id="line.549"></span>
<span class="source-line-no">550</span><span id="line.550">                    PositionCoordinate lastSelectedCell = getSelectionLayer().getLastSelectedCellPosition();</span>
<span class="source-line-no">551</span><span id="line.551">                    if (lastSelectedCell != null) {</span>
<span class="source-line-no">552</span><span id="line.552">                        /*</span>
<span class="source-line-no">553</span><span id="line.553">                         * Send down a cell selection event for the current cell to update the cell</span>
<span class="source-line-no">554</span><span id="line.554">                         * value labels</span>
<span class="source-line-no">555</span><span id="line.555">                         */</span>
<span class="source-line-no">556</span><span id="line.556">                        dataTable.doCommand(new SelectCellCommand(getSelectionLayer(), lastSelectedCell.columnPosition,</span>
<span class="source-line-no">557</span><span id="line.557">                                lastSelectedCell.rowPosition, false, false));</span>
<span class="source-line-no">558</span><span id="line.558">                    }</span>
<span class="source-line-no">559</span><span id="line.559">                }</span>
<span class="source-line-no">560</span><span id="line.560">            });</span>
<span class="source-line-no">561</span><span id="line.561"></span>
<span class="source-line-no">562</span><span id="line.562">            checkEnum = new MenuItem(dataDisplayMenu, SWT.CHECK);</span>
<span class="source-line-no">563</span><span id="line.563">            checkEnum.setText("Show Enum Values");</span>
<span class="source-line-no">564</span><span id="line.564">            checkEnum.addSelectionListener(new SelectionAdapter() {</span>
<span class="source-line-no">565</span><span id="line.565">                @Override</span>
<span class="source-line-no">566</span><span id="line.566">                public void widgetSelected(SelectionEvent e) {</span>
<span class="source-line-no">567</span><span id="line.567">                    isEnumConverted = checkEnum.getSelection();</span>
<span class="source-line-no">568</span><span id="line.568">                    if (isEnumConverted) {</span>
<span class="source-line-no">569</span><span id="line.569">                        if (checkScientificNotation != null) checkScientificNotation.setSelection(false);</span>
<span class="source-line-no">570</span><span id="line.570">                        if (checkCustomNotation != null) checkCustomNotation.setSelection(false);</span>
<span class="source-line-no">571</span><span id="line.571">                        if (checkHex != null) checkHex.setSelection(false);</span>
<span class="source-line-no">572</span><span id="line.572">                        if (checkBin != null) checkBin.setSelection(false);</span>
<span class="source-line-no">573</span><span id="line.573"></span>
<span class="source-line-no">574</span><span id="line.574">                        showAsBin = false;</span>
<span class="source-line-no">575</span><span id="line.575">                        showAsHex = false;</span>
<span class="source-line-no">576</span><span id="line.576">                        numberFormat = normalFormat;</span>
<span class="source-line-no">577</span><span id="line.577">                    }</span>
<span class="source-line-no">578</span><span id="line.578"></span>
<span class="source-line-no">579</span><span id="line.579">                    updateDataConversionSettings();</span>
<span class="source-line-no">580</span><span id="line.580"></span>
<span class="source-line-no">581</span><span id="line.581">                    dataTable.doCommand(new VisualRefreshCommand());</span>
<span class="source-line-no">582</span><span id="line.582"></span>
<span class="source-line-no">583</span><span id="line.583">                    PositionCoordinate lastSelectedCell = getSelectionLayer().getLastSelectedCellPosition();</span>
<span class="source-line-no">584</span><span id="line.584">                    if (lastSelectedCell != null) {</span>
<span class="source-line-no">585</span><span id="line.585">                        /*</span>
<span class="source-line-no">586</span><span id="line.586">                         * Send down a cell selection event for the current cell to update the cell</span>
<span class="source-line-no">587</span><span id="line.587">                         * value labels</span>
<span class="source-line-no">588</span><span id="line.588">                         */</span>
<span class="source-line-no">589</span><span id="line.589">                        dataTable.doCommand(new SelectCellCommand(getSelectionLayer(), lastSelectedCell.columnPosition,</span>
<span class="source-line-no">590</span><span id="line.590">                                lastSelectedCell.rowPosition, false, false));</span>
<span class="source-line-no">591</span><span id="line.591">                    }</span>
<span class="source-line-no">592</span><span id="line.592">                }</span>
<span class="source-line-no">593</span><span id="line.593">            });</span>
<span class="source-line-no">594</span><span id="line.594">        }</span>
<span class="source-line-no">595</span><span id="line.595"></span>
<span class="source-line-no">596</span><span id="line.596">        return baseMenu;</span>
<span class="source-line-no">597</span><span id="line.597">    }</span>
<span class="source-line-no">598</span><span id="line.598"></span>
<span class="source-line-no">599</span><span id="line.599">    /**</span>
<span class="source-line-no">600</span><span id="line.600">     * Creates a NatTable for a Scalar dataset.</span>
<span class="source-line-no">601</span><span id="line.601">     *</span>
<span class="source-line-no">602</span><span id="line.602">     * @param parent</span>
<span class="source-line-no">603</span><span id="line.603">     *            The parent for the NatTable</span>
<span class="source-line-no">604</span><span id="line.604">     * @param dataObject</span>
<span class="source-line-no">605</span><span id="line.605">     *            The Scalar dataset for the NatTable to display</span>
<span class="source-line-no">606</span><span id="line.606">     *</span>
<span class="source-line-no">607</span><span id="line.607">     * @return The newly created NatTable</span>
<span class="source-line-no">608</span><span id="line.608">     */</span>
<span class="source-line-no">609</span><span id="line.609">    @Override</span>
<span class="source-line-no">610</span><span id="line.610">    protected NatTable createTable(Composite parent, DataFormat dataObject) {</span>
<span class="source-line-no">611</span><span id="line.611">        // Create body layer</span>
<span class="source-line-no">612</span><span id="line.612">        try {</span>
<span class="source-line-no">613</span><span id="line.613">            dataProvider = DataProviderFactory.getDataProvider(dataObject, dataValue, isDataTransposed);</span>
<span class="source-line-no">614</span><span id="line.614"></span>
<span class="source-line-no">615</span><span id="line.615">            log.trace("createTable(): rows={} : cols={}", dataProvider.getRowCount(), dataProvider.getColumnCount());</span>
<span class="source-line-no">616</span><span id="line.616"></span>
<span class="source-line-no">617</span><span id="line.617">            dataLayer = new DataLayer(dataProvider);</span>
<span class="source-line-no">618</span><span id="line.618">        }</span>
<span class="source-line-no">619</span><span id="line.619">        catch (Exception ex) {</span>
<span class="source-line-no">620</span><span id="line.620">            log.debug("createTable(): failed to retrieve DataProvider for table: ", ex);</span>
<span class="source-line-no">621</span><span id="line.621">            return null;</span>
<span class="source-line-no">622</span><span id="line.622">        }</span>
<span class="source-line-no">623</span><span id="line.623"></span>
<span class="source-line-no">624</span><span id="line.624">        selectionLayer = new SelectionLayer(dataLayer);</span>
<span class="source-line-no">625</span><span id="line.625">        final ViewportLayer viewportLayer = new ViewportLayer(selectionLayer);</span>
<span class="source-line-no">626</span><span id="line.626"></span>
<span class="source-line-no">627</span><span id="line.627">        dataLayer.setDefaultColumnWidth(80);</span>
<span class="source-line-no">628</span><span id="line.628"></span>
<span class="source-line-no">629</span><span id="line.629">        // Create the Column Header layer</span>
<span class="source-line-no">630</span><span id="line.630">        columnHeaderDataProvider = new ScalarDSColumnHeaderDataProvider(dataObject);</span>
<span class="source-line-no">631</span><span id="line.631">        ColumnHeaderLayer columnHeaderLayer = new ColumnHeader(new DataLayer(columnHeaderDataProvider), viewportLayer,</span>
<span class="source-line-no">632</span><span id="line.632">                selectionLayer);</span>
<span class="source-line-no">633</span><span id="line.633"></span>
<span class="source-line-no">634</span><span id="line.634">        // Create the Row Header layer</span>
<span class="source-line-no">635</span><span id="line.635">        rowHeaderDataProvider = new RowHeaderDataProvider(dataObject);</span>
<span class="source-line-no">636</span><span id="line.636"></span>
<span class="source-line-no">637</span><span id="line.637">        // Try to adapt row height to current font</span>
<span class="source-line-no">638</span><span id="line.638">        int defaultRowHeight = curFont == null ? 20 : (2 * curFont.getFontData()[0].getHeight());</span>
<span class="source-line-no">639</span><span id="line.639"></span>
<span class="source-line-no">640</span><span id="line.640">        DataLayer baseLayer = new DataLayer(rowHeaderDataProvider, 40, defaultRowHeight);</span>
<span class="source-line-no">641</span><span id="line.641">        RowHeaderLayer rowHeaderLayer = new RowHeader(baseLayer, viewportLayer, selectionLayer);</span>
<span class="source-line-no">642</span><span id="line.642"></span>
<span class="source-line-no">643</span><span id="line.643">        // Create the Corner Layer</span>
<span class="source-line-no">644</span><span id="line.644">        ILayer cornerLayer = new CornerLayer(</span>
<span class="source-line-no">645</span><span id="line.645">                new DataLayer(new DefaultCornerDataProvider(columnHeaderDataProvider, rowHeaderDataProvider)),</span>
<span class="source-line-no">646</span><span id="line.646">                rowHeaderLayer, columnHeaderLayer);</span>
<span class="source-line-no">647</span><span id="line.647"></span>
<span class="source-line-no">648</span><span id="line.648">        // Create the Grid Layer</span>
<span class="source-line-no">649</span><span id="line.649">        GridLayer gridLayer = new EditingGridLayer(viewportLayer, columnHeaderLayer, rowHeaderLayer, cornerLayer);</span>
<span class="source-line-no">650</span><span id="line.650"></span>
<span class="source-line-no">651</span><span id="line.651">        final NatTable natTable = new NatTable(parent, gridLayer, false);</span>
<span class="source-line-no">652</span><span id="line.652">        natTable.addConfiguration(new DefaultNatTableStyleConfiguration());</span>
<span class="source-line-no">653</span><span id="line.653">        natTable.addLayerListener(new ScalarDSCellSelectionListener());</span>
<span class="source-line-no">654</span><span id="line.654"></span>
<span class="source-line-no">655</span><span id="line.655">        // Create popup menu for region or object ref.</span>
<span class="source-line-no">656</span><span id="line.656">        if (isRegRef || isObjRef) {</span>
<span class="source-line-no">657</span><span id="line.657">            natTable.addConfiguration(new RefContextMenu(natTable));</span>
<span class="source-line-no">658</span><span id="line.658">        }</span>
<span class="source-line-no">659</span><span id="line.659"></span>
<span class="source-line-no">660</span><span id="line.660">        natTable.configure();</span>
<span class="source-line-no">661</span><span id="line.661"></span>
<span class="source-line-no">662</span><span id="line.662">        return natTable;</span>
<span class="source-line-no">663</span><span id="line.663">    }</span>
<span class="source-line-no">664</span><span id="line.664"></span>
<span class="source-line-no">665</span><span id="line.665">    /**</span>
<span class="source-line-no">666</span><span id="line.666">     * Returns the selected data values of the ScalarDS</span>
<span class="source-line-no">667</span><span id="line.667">     */</span>
<span class="source-line-no">668</span><span id="line.668">    @Override</span>
<span class="source-line-no">669</span><span id="line.669">    public Object getSelectedData() {</span>
<span class="source-line-no">670</span><span id="line.670">        Object selectedData = null;</span>
<span class="source-line-no">671</span><span id="line.671"></span>
<span class="source-line-no">672</span><span id="line.672">        // Since NatTable returns the selected row positions as a Set&lt;Range&gt;, convert</span>
<span class="source-line-no">673</span><span id="line.673">        // this to an Integer[]</span>
<span class="source-line-no">674</span><span id="line.674">        Set&lt;Range&gt; rowPositions = selectionLayer.getSelectedRowPositions();</span>
<span class="source-line-no">675</span><span id="line.675">        Set&lt;Integer&gt; selectedRowPos = new LinkedHashSet&lt;&gt;();</span>
<span class="source-line-no">676</span><span id="line.676">        Iterator&lt;Range&gt; i1 = rowPositions.iterator();</span>
<span class="source-line-no">677</span><span id="line.677">        while (i1.hasNext()) {</span>
<span class="source-line-no">678</span><span id="line.678">            selectedRowPos.addAll(i1.next().getMembers());</span>
<span class="source-line-no">679</span><span id="line.679">        }</span>
<span class="source-line-no">680</span><span id="line.680"></span>
<span class="source-line-no">681</span><span id="line.681">        Integer[] selectedRows = selectedRowPos.toArray(new Integer[0]);</span>
<span class="source-line-no">682</span><span id="line.682">        int[] selectedCols = selectionLayer.getSelectedColumnPositions();</span>
<span class="source-line-no">683</span><span id="line.683"></span>
<span class="source-line-no">684</span><span id="line.684">        if (selectedRows == null || selectedRows.length &lt;= 0 || selectedCols == null || selectedCols.length &lt;= 0) {</span>
<span class="source-line-no">685</span><span id="line.685">            return null;</span>
<span class="source-line-no">686</span><span id="line.686">        }</span>
<span class="source-line-no">687</span><span id="line.687"></span>
<span class="source-line-no">688</span><span id="line.688">        int size = selectedCols.length * selectedRows.length;</span>
<span class="source-line-no">689</span><span id="line.689">        log.trace("getSelectedData() data size: {}", size);</span>
<span class="source-line-no">690</span><span id="line.690"></span>
<span class="source-line-no">691</span><span id="line.691">        // the whole table is selected</span>
<span class="source-line-no">692</span><span id="line.692">        if ((dataTable.getPreferredColumnCount() - 1 == selectedCols.length)</span>
<span class="source-line-no">693</span><span id="line.693">                &amp;&amp; (dataTable.getPreferredRowCount() - 1 == selectedRows.length)) {</span>
<span class="source-line-no">694</span><span id="line.694">            return dataValue;</span>
<span class="source-line-no">695</span><span id="line.695">        }</span>
<span class="source-line-no">696</span><span id="line.696"></span>
<span class="source-line-no">697</span><span id="line.697">        if (isRegRef) {</span>
<span class="source-line-no">698</span><span id="line.698">            // reg. ref data are stored in strings</span>
<span class="source-line-no">699</span><span id="line.699">            selectedData = new String[size];</span>
<span class="source-line-no">700</span><span id="line.700">        }</span>
<span class="source-line-no">701</span><span id="line.701">        else {</span>
<span class="source-line-no">702</span><span id="line.702">            switch (Utils.getJavaObjectRuntimeClass(dataValue)) {</span>
<span class="source-line-no">703</span><span id="line.703">                case 'B':</span>
<span class="source-line-no">704</span><span id="line.704">                    selectedData = new byte[size];</span>
<span class="source-line-no">705</span><span id="line.705">                    break;</span>
<span class="source-line-no">706</span><span id="line.706">                case 'S':</span>
<span class="source-line-no">707</span><span id="line.707">                    selectedData = new short[size];</span>
<span class="source-line-no">708</span><span id="line.708">                    break;</span>
<span class="source-line-no">709</span><span id="line.709">                case 'I':</span>
<span class="source-line-no">710</span><span id="line.710">                    selectedData = new int[size];</span>
<span class="source-line-no">711</span><span id="line.711">                    break;</span>
<span class="source-line-no">712</span><span id="line.712">                case 'J':</span>
<span class="source-line-no">713</span><span id="line.713">                    selectedData = new long[size];</span>
<span class="source-line-no">714</span><span id="line.714">                    break;</span>
<span class="source-line-no">715</span><span id="line.715">                case 'F':</span>
<span class="source-line-no">716</span><span id="line.716">                    selectedData = new float[size];</span>
<span class="source-line-no">717</span><span id="line.717">                    break;</span>
<span class="source-line-no">718</span><span id="line.718">                case 'D':</span>
<span class="source-line-no">719</span><span id="line.719">                    selectedData = new double[size];</span>
<span class="source-line-no">720</span><span id="line.720">                    break;</span>
<span class="source-line-no">721</span><span id="line.721">                default:</span>
<span class="source-line-no">722</span><span id="line.722">                    selectedData = null;</span>
<span class="source-line-no">723</span><span id="line.723">                    break;</span>
<span class="source-line-no">724</span><span id="line.724">            }</span>
<span class="source-line-no">725</span><span id="line.725">        }</span>
<span class="source-line-no">726</span><span id="line.726"></span>
<span class="source-line-no">727</span><span id="line.727">        if (selectedData == null) {</span>
<span class="source-line-no">728</span><span id="line.728">            shell.getDisplay().beep();</span>
<span class="source-line-no">729</span><span id="line.729">            Tools.showError(shell, "Select", "Unsupported data type.");</span>
<span class="source-line-no">730</span><span id="line.730">            return null;</span>
<span class="source-line-no">731</span><span id="line.731">        }</span>
<span class="source-line-no">732</span><span id="line.732"></span>
<span class="source-line-no">733</span><span id="line.733">        log.trace("getSelectedData(): selectedData is type {}", Utils.getJavaObjectRuntimeClass(dataValue));</span>
<span class="source-line-no">734</span><span id="line.734"></span>
<span class="source-line-no">735</span><span id="line.735">        int w = dataTable.getPreferredColumnCount() - 1;</span>
<span class="source-line-no">736</span><span id="line.736">        log.trace("getSelectedData(): getColumnCount={}", w);</span>
<span class="source-line-no">737</span><span id="line.737">        int idxSrc = 0;</span>
<span class="source-line-no">738</span><span id="line.738">        int idxDst = 0;</span>
<span class="source-line-no">739</span><span id="line.739">        log.trace("getSelectedData(): Rows.length={} Cols.length={}", selectedRows.length,</span>
<span class="source-line-no">740</span><span id="line.740">                selectedCols.length);</span>
<span class="source-line-no">741</span><span id="line.741">        for (int i = 0; i &lt; selectedRows.length; i++) {</span>
<span class="source-line-no">742</span><span id="line.742">            for (int j = 0; j &lt; selectedCols.length; j++) {</span>
<span class="source-line-no">743</span><span id="line.743">                idxSrc = selectedRows[i] * w + selectedCols[j];</span>
<span class="source-line-no">744</span><span id="line.744">                log.trace("getSelectedData()[{},{}]: dataValue[{}]={} from r{} and c{}", i, j,</span>
<span class="source-line-no">745</span><span id="line.745">                        idxSrc, Array.get(dataValue, idxSrc), selectedRows[i], selectedCols[j]);</span>
<span class="source-line-no">746</span><span id="line.746">                Array.set(selectedData, idxDst, Array.get(dataValue, idxSrc));</span>
<span class="source-line-no">747</span><span id="line.747">                log.trace("getSelectedData()[{},{}]: selectedData[{}]={}", i, j, idxDst,</span>
<span class="source-line-no">748</span><span id="line.748">                        Array.get(selectedData, idxDst));</span>
<span class="source-line-no">749</span><span id="line.749">                idxDst++;</span>
<span class="source-line-no">750</span><span id="line.750">            }</span>
<span class="source-line-no">751</span><span id="line.751">        }</span>
<span class="source-line-no">752</span><span id="line.752"></span>
<span class="source-line-no">753</span><span id="line.753">        return selectedData;</span>
<span class="source-line-no">754</span><span id="line.754">    }</span>
<span class="source-line-no">755</span><span id="line.755"></span>
<span class="source-line-no">756</span><span id="line.756">    /**</span>
<span class="source-line-no">757</span><span id="line.757">     * Returns an IEditableRule that determines whether cells can be edited.</span>
<span class="source-line-no">758</span><span id="line.758">     *</span>
<span class="source-line-no">759</span><span id="line.759">     * Cells can be edited as long as the dataset is not opened in read-only mode</span>
<span class="source-line-no">760</span><span id="line.760">     * and the data is not currently displayed in hexadecimal, binary, or character</span>
<span class="source-line-no">761</span><span id="line.761">     * mode.</span>
<span class="source-line-no">762</span><span id="line.762">     *</span>
<span class="source-line-no">763</span><span id="line.763">     * @param dataObject</span>
<span class="source-line-no">764</span><span id="line.764">     *            The dataset for editing</span>
<span class="source-line-no">765</span><span id="line.765">     *</span>
<span class="source-line-no">766</span><span id="line.766">     * @return a new IEditableRule for the dataset</span>
<span class="source-line-no">767</span><span id="line.767">     */</span>
<span class="source-line-no">768</span><span id="line.768">    @Override</span>
<span class="source-line-no">769</span><span id="line.769">    protected IEditableRule getDataEditingRule(final DataFormat dataObject) {</span>
<span class="source-line-no">770</span><span id="line.770">        if (dataObject == null) return null;</span>
<span class="source-line-no">771</span><span id="line.771"></span>
<span class="source-line-no">772</span><span id="line.772">        // Only Allow editing if not in read-only mode</span>
<span class="source-line-no">773</span><span id="line.773">        return new EditableRule() {</span>
<span class="source-line-no">774</span><span id="line.774">            @Override</span>
<span class="source-line-no">775</span><span id="line.775">            public boolean isEditable(int columnIndex, int rowIndex) {</span>
<span class="source-line-no">776</span><span id="line.776">                /*</span>
<span class="source-line-no">777</span><span id="line.777">                 * TODO: Should be able to edit character-displayed types and datasets when</span>
<span class="source-line-no">778</span><span id="line.778">                 * displayed as hex/binary.</span>
<span class="source-line-no">779</span><span id="line.779">                 */</span>
<span class="source-line-no">780</span><span id="line.780">                return !(isReadOnly || isDisplayTypeChar || showAsBin || showAsHex);</span>
<span class="source-line-no">781</span><span id="line.781">            }</span>
<span class="source-line-no">782</span><span id="line.782">        };</span>
<span class="source-line-no">783</span><span id="line.783">    }</span>
<span class="source-line-no">784</span><span id="line.784"></span>
<span class="source-line-no">785</span><span id="line.785">    /**</span>
<span class="source-line-no">786</span><span id="line.786">     * Display data pointed to by object references. Data of each object is shown in</span>
<span class="source-line-no">787</span><span id="line.787">     * a separate spreadsheet.</span>
<span class="source-line-no">788</span><span id="line.788">     *</span>
<span class="source-line-no">789</span><span id="line.789">     * @param ref</span>
<span class="source-line-no">790</span><span id="line.790">     *            the array of strings that contain the object reference</span>
<span class="source-line-no">791</span><span id="line.791">     *            information.</span>
<span class="source-line-no">792</span><span id="line.792">     *</span>
<span class="source-line-no">793</span><span id="line.793">     */</span>
<span class="source-line-no">794</span><span id="line.794">    @Override</span>
<span class="source-line-no">795</span><span id="line.795">    @SuppressWarnings({ "rawtypes", "unchecked" })</span>
<span class="source-line-no">796</span><span id="line.796">    protected void showObjRefData(long ref) {</span>
<span class="source-line-no">797</span><span id="line.797">        long[] oid = { ref };</span>
<span class="source-line-no">798</span><span id="line.798">        log.trace("showObjRefData(): start: ref={}", ref);</span>
<span class="source-line-no">799</span><span id="line.799"></span>
<span class="source-line-no">800</span><span id="line.800">        HObject obj = FileFormat.findObject(((HObject) dataObject).getFileFormat(), oid);</span>
<span class="source-line-no">801</span><span id="line.801">        if (obj == null || !(obj instanceof ScalarDS)) {</span>
<span class="source-line-no">802</span><span id="line.802">            Tools.showError(shell, "Select", "Could not show object reference data: invalid or null data");</span>
<span class="source-line-no">803</span><span id="line.803">            log.debug("showObjRefData(): obj is null or not a Scalar Dataset");</span>
<span class="source-line-no">804</span><span id="line.804">            return;</span>
<span class="source-line-no">805</span><span id="line.805">        }</span>
<span class="source-line-no">806</span><span id="line.806"></span>
<span class="source-line-no">807</span><span id="line.807">        ScalarDS dset = (ScalarDS) obj;</span>
<span class="source-line-no">808</span><span id="line.808">        ScalarDS dsetCopy = null;</span>
<span class="source-line-no">809</span><span id="line.809"></span>
<span class="source-line-no">810</span><span id="line.810">        // create an instance of the dataset constructor</span>
<span class="source-line-no">811</span><span id="line.811">        Constructor&lt;? extends ScalarDS&gt; constructor = null;</span>
<span class="source-line-no">812</span><span id="line.812">        Object[] paramObj = null;</span>
<span class="source-line-no">813</span><span id="line.813">        Object data = null;</span>
<span class="source-line-no">814</span><span id="line.814"></span>
<span class="source-line-no">815</span><span id="line.815">        try {</span>
<span class="source-line-no">816</span><span id="line.816">            Class[] paramClass = { FileFormat.class, String.class, String.class };</span>
<span class="source-line-no">817</span><span id="line.817">            constructor = dset.getClass().getConstructor(paramClass);</span>
<span class="source-line-no">818</span><span id="line.818">            paramObj = new Object[] { dset.getFileFormat(), dset.getName(), dset.getPath() };</span>
<span class="source-line-no">819</span><span id="line.819">            dsetCopy = constructor.newInstance(paramObj);</span>
<span class="source-line-no">820</span><span id="line.820">            data = dsetCopy.getData();</span>
<span class="source-line-no">821</span><span id="line.821">        }</span>
<span class="source-line-no">822</span><span id="line.822">        catch (Exception ex) {</span>
<span class="source-line-no">823</span><span id="line.823">            log.debug("showObjRefData(): couldn't show data: ", ex);</span>
<span class="source-line-no">824</span><span id="line.824">            Tools.showError(shell, "Select", "Object Reference: " + ex.getMessage());</span>
<span class="source-line-no">825</span><span id="line.825">            data = null;</span>
<span class="source-line-no">826</span><span id="line.826">        }</span>
<span class="source-line-no">827</span><span id="line.827"></span>
<span class="source-line-no">828</span><span id="line.828">        if (data == null) {</span>
<span class="source-line-no">829</span><span id="line.829">            return;</span>
<span class="source-line-no">830</span><span id="line.830">        }</span>
<span class="source-line-no">831</span><span id="line.831"></span>
<span class="source-line-no">832</span><span id="line.832">        Class&lt;?&gt; theClass = null;</span>
<span class="source-line-no">833</span><span id="line.833">        String viewName = null;</span>
<span class="source-line-no">834</span><span id="line.834"></span>
<span class="source-line-no">835</span><span id="line.835">        switch (viewType) {</span>
<span class="source-line-no">836</span><span id="line.836">            case IMAGE:</span>
<span class="source-line-no">837</span><span id="line.837">                viewName = HDFView.getListOfImageViews().get(0);</span>
<span class="source-line-no">838</span><span id="line.838">                break;</span>
<span class="source-line-no">839</span><span id="line.839">            case TABLE:</span>
<span class="source-line-no">840</span><span id="line.840">                viewName = (String) HDFView.getListOfTableViews().get(0);</span>
<span class="source-line-no">841</span><span id="line.841">                break;</span>
<span class="source-line-no">842</span><span id="line.842">            default:</span>
<span class="source-line-no">843</span><span id="line.843">                viewName = null;</span>
<span class="source-line-no">844</span><span id="line.844">        }</span>
<span class="source-line-no">845</span><span id="line.845"></span>
<span class="source-line-no">846</span><span id="line.846">        try {</span>
<span class="source-line-no">847</span><span id="line.847">            theClass = Class.forName(viewName);</span>
<span class="source-line-no">848</span><span id="line.848">        }</span>
<span class="source-line-no">849</span><span id="line.849">        catch (Exception ex) {</span>
<span class="source-line-no">850</span><span id="line.850">            try {</span>
<span class="source-line-no">851</span><span id="line.851">                theClass = ViewProperties.loadExtClass().loadClass(viewName);</span>
<span class="source-line-no">852</span><span id="line.852">            }</span>
<span class="source-line-no">853</span><span id="line.853">            catch (Exception ex2) {</span>
<span class="source-line-no">854</span><span id="line.854">                theClass = null;</span>
<span class="source-line-no">855</span><span id="line.855">            }</span>
<span class="source-line-no">856</span><span id="line.856">        }</span>
<span class="source-line-no">857</span><span id="line.857"></span>
<span class="source-line-no">858</span><span id="line.858">        // Use default dataview</span>
<span class="source-line-no">859</span><span id="line.859">        if (theClass == null) {</span>
<span class="source-line-no">860</span><span id="line.860">            switch (viewType) {</span>
<span class="source-line-no">861</span><span id="line.861">                case IMAGE:</span>
<span class="source-line-no">862</span><span id="line.862">                    viewName = ViewProperties.DEFAULT_IMAGEVIEW_NAME;</span>
<span class="source-line-no">863</span><span id="line.863">                    break;</span>
<span class="source-line-no">864</span><span id="line.864">                case TABLE:</span>
<span class="source-line-no">865</span><span id="line.865">                    viewName = ViewProperties.DEFAULT_SCALAR_DATASET_TABLEVIEW_NAME;</span>
<span class="source-line-no">866</span><span id="line.866">                    break;</span>
<span class="source-line-no">867</span><span id="line.867">                default:</span>
<span class="source-line-no">868</span><span id="line.868">                    viewName = null;</span>
<span class="source-line-no">869</span><span id="line.869">            }</span>
<span class="source-line-no">870</span><span id="line.870"></span>
<span class="source-line-no">871</span><span id="line.871">            try {</span>
<span class="source-line-no">872</span><span id="line.872">                theClass = Class.forName(viewName);</span>
<span class="source-line-no">873</span><span id="line.873">            }</span>
<span class="source-line-no">874</span><span id="line.874">            catch (Exception ex) {</span>
<span class="source-line-no">875</span><span id="line.875">                log.debug("showObjRefData(): no suitable display class found");</span>
<span class="source-line-no">876</span><span id="line.876">                Tools.showError(shell, "Select", "Could not show reference data: no suitable display class found");</span>
<span class="source-line-no">877</span><span id="line.877">                return;</span>
<span class="source-line-no">878</span><span id="line.878">            }</span>
<span class="source-line-no">879</span><span id="line.879">        }</span>
<span class="source-line-no">880</span><span id="line.880"></span>
<span class="source-line-no">881</span><span id="line.881">        HashMap map = new HashMap(1);</span>
<span class="source-line-no">882</span><span id="line.882">        map.put(ViewProperties.DATA_VIEW_KEY.OBJECT, dsetCopy);</span>
<span class="source-line-no">883</span><span id="line.883">        Object[] args = { viewer, map };</span>
<span class="source-line-no">884</span><span id="line.884"></span>
<span class="source-line-no">885</span><span id="line.885">        try {</span>
<span class="source-line-no">886</span><span id="line.886">            Tools.newInstance(theClass, args);</span>
<span class="source-line-no">887</span><span id="line.887">        }</span>
<span class="source-line-no">888</span><span id="line.888">        catch (Exception ex) {</span>
<span class="source-line-no">889</span><span id="line.889">            log.debug("showObjRefData(): Could not show reference data: ", ex);</span>
<span class="source-line-no">890</span><span id="line.890">            Tools.showError(shell, "Select", "Could not show reference data: " + ex.toString());</span>
<span class="source-line-no">891</span><span id="line.891">        }</span>
<span class="source-line-no">892</span><span id="line.892">    }</span>
<span class="source-line-no">893</span><span id="line.893"></span>
<span class="source-line-no">894</span><span id="line.894">    /**</span>
<span class="source-line-no">895</span><span id="line.895">     * Display data pointed to by region references. Data of each region is shown in</span>
<span class="source-line-no">896</span><span id="line.896">     * a separate spreadsheet. The reg. ref. information is stored in strings of the</span>
<span class="source-line-no">897</span><span id="line.897">     * format below:</span>
<span class="source-line-no">898</span><span id="line.898">     * &lt;ul&gt;</span>
<span class="source-line-no">899</span><span id="line.899">     * &lt;li&gt;For point selections: "&lt;code&gt;file_id:obj_id { [point1] [point2] ...) }&lt;/code&gt;", where</span>
<span class="source-line-no">900</span><span id="line.900">     * &lt;code&gt;[point1]&lt;/code&gt; is in the form of (location_of_dim0, location_of_dim1, ...). For</span>
<span class="source-line-no">901</span><span id="line.901">     * example, &lt;code&gt;0:800 { (0,1) (2,11) (1,0) (2,4) }&lt;/code&gt;&lt;/li&gt;</span>
<span class="source-line-no">902</span><span id="line.902">     * &lt;li&gt;For rectangle selections: "&lt;code&gt;file_id:obj_id { [corner coordinates1] [corner coordinates2] ... }&lt;/code&gt;",</span>
<span class="source-line-no">903</span><span id="line.903">     * where [corner coordinates1] is in the form of</span>
<span class="source-line-no">904</span><span id="line.904">     * (start_corner)-(oposite_corner). For example, &lt;code&gt;0:800 { (0,0)-(0,2) (0,11)-(0,13) (2,0)-(2,2) (2,11)-(2,13) }&lt;/code&gt;&lt;/li&gt;</span>
<span class="source-line-no">905</span><span id="line.905">     * &lt;/ul&gt;</span>
<span class="source-line-no">906</span><span id="line.906">     *</span>
<span class="source-line-no">907</span><span id="line.907">     * @param reg</span>
<span class="source-line-no">908</span><span id="line.908">     *            the array of strings that contain the reg. ref information.</span>
<span class="source-line-no">909</span><span id="line.909">     *</span>
<span class="source-line-no">910</span><span id="line.910">     */</span>
<span class="source-line-no">911</span><span id="line.911">    @Override</span>
<span class="source-line-no">912</span><span id="line.912">    @SuppressWarnings({ "rawtypes", "unchecked" })</span>
<span class="source-line-no">913</span><span id="line.913">    protected void showRegRefData(String reg) {</span>
<span class="source-line-no">914</span><span id="line.914">        log.trace("showRegRefData(): start: reg={}", reg);</span>
<span class="source-line-no">915</span><span id="line.915"></span>
<span class="source-line-no">916</span><span id="line.916">        if (reg == null || (reg.length() &lt;= 0) || (reg.compareTo("NULL") == 0)) {</span>
<span class="source-line-no">917</span><span id="line.917">            Tools.showError(shell, "Select", "Could not show region reference data: invalid or null data");</span>
<span class="source-line-no">918</span><span id="line.918">            log.debug("showRegRefData(): ref is null or invalid");</span>
<span class="source-line-no">919</span><span id="line.919">            return;</span>
<span class="source-line-no">920</span><span id="line.920">        }</span>
<span class="source-line-no">921</span><span id="line.921"></span>
<span class="source-line-no">922</span><span id="line.922">        boolean isPointSelection = (reg.indexOf('-') &lt;= 0);</span>
<span class="source-line-no">923</span><span id="line.923"></span>
<span class="source-line-no">924</span><span id="line.924">        // find the object location</span>
<span class="source-line-no">925</span><span id="line.925">        String oidStr = reg.substring(reg.indexOf('/'), reg.indexOf("REGION_TYPE")-1);</span>
<span class="source-line-no">926</span><span id="line.926">        log.trace("showRegRefData(): isPointSelection={} oidStr={}", isPointSelection,</span>
<span class="source-line-no">927</span><span id="line.927">                oidStr);</span>
<span class="source-line-no">928</span><span id="line.928"></span>
<span class="source-line-no">929</span><span id="line.929">        // decode the region selection</span>
<span class="source-line-no">930</span><span id="line.930">        String regStr = reg.substring(reg.indexOf('{') + 1, reg.indexOf('}'));</span>
<span class="source-line-no">931</span><span id="line.931">        if (regStr == null || regStr.length() &lt;= 0) {</span>
<span class="source-line-no">932</span><span id="line.932">            Tools.showError(shell, "Select", "Could not show region reference data: no region selection made.");</span>
<span class="source-line-no">933</span><span id="line.933">            log.debug("showRegRefData(): no region selection made");</span>
<span class="source-line-no">934</span><span id="line.934">            return; // no selection</span>
<span class="source-line-no">935</span><span id="line.935">        }</span>
<span class="source-line-no">936</span><span id="line.936"></span>
<span class="source-line-no">937</span><span id="line.937">        // TODO: do we need to do something with what's past the closing bracket</span>
<span class="source-line-no">938</span><span id="line.938">        // regStr = reg.substring(reg.indexOf('}') + 1);</span>
<span class="source-line-no">939</span><span id="line.939"></span>
<span class="source-line-no">940</span><span id="line.940">        StringTokenizer st = new StringTokenizer(regStr);</span>
<span class="source-line-no">941</span><span id="line.941">        int nSelections = st.countTokens();</span>
<span class="source-line-no">942</span><span id="line.942">        if (nSelections &lt;= 0) {</span>
<span class="source-line-no">943</span><span id="line.943">            Tools.showError(shell, "Select", "Could not show region reference data: no region selection made.");</span>
<span class="source-line-no">944</span><span id="line.944">            log.debug("showRegRefData(): no region selection made");</span>
<span class="source-line-no">945</span><span id="line.945">            return; // no selection</span>
<span class="source-line-no">946</span><span id="line.946">        }</span>
<span class="source-line-no">947</span><span id="line.947">        log.trace("showRegRefData(): nSelections={}", nSelections);</span>
<span class="source-line-no">948</span><span id="line.948"></span>
<span class="source-line-no">949</span><span id="line.949">        HObject obj = FileFormat.findObject(((HObject) dataObject).getFileFormat(), oidStr);</span>
<span class="source-line-no">950</span><span id="line.950">        if (obj == null || !(obj instanceof ScalarDS)) {</span>
<span class="source-line-no">951</span><span id="line.951">            Tools.showError(shell, "Select", "Could not show object reference data: invalid or null data");</span>
<span class="source-line-no">952</span><span id="line.952">            log.debug("showRegRefData(): obj is null or not a Scalar Dataset");</span>
<span class="source-line-no">953</span><span id="line.953">            return;</span>
<span class="source-line-no">954</span><span id="line.954">        }</span>
<span class="source-line-no">955</span><span id="line.955"></span>
<span class="source-line-no">956</span><span id="line.956">        ScalarDS dset = (ScalarDS) obj;</span>
<span class="source-line-no">957</span><span id="line.957">        ScalarDS dsetCopy = null;</span>
<span class="source-line-no">958</span><span id="line.958"></span>
<span class="source-line-no">959</span><span id="line.959">        // create an instance of the dataset constructor</span>
<span class="source-line-no">960</span><span id="line.960">        Constructor&lt;? extends ScalarDS&gt; constructor = null;</span>
<span class="source-line-no">961</span><span id="line.961">        Object[] paramObj = null;</span>
<span class="source-line-no">962</span><span id="line.962">        try {</span>
<span class="source-line-no">963</span><span id="line.963">            Class[] paramClass = { FileFormat.class, String.class, String.class };</span>
<span class="source-line-no">964</span><span id="line.964">            constructor = dset.getClass().getConstructor(paramClass);</span>
<span class="source-line-no">965</span><span id="line.965">            paramObj = new Object[] { dset.getFileFormat(), dset.getName(), dset.getPath() };</span>
<span class="source-line-no">966</span><span id="line.966">        }</span>
<span class="source-line-no">967</span><span id="line.967">        catch (Exception ex) {</span>
<span class="source-line-no">968</span><span id="line.968">            log.debug("showRegRefData(): constructor failure: ", ex);</span>
<span class="source-line-no">969</span><span id="line.969">            constructor = null;</span>
<span class="source-line-no">970</span><span id="line.970">        }</span>
<span class="source-line-no">971</span><span id="line.971"></span>
<span class="source-line-no">972</span><span id="line.972">        // load each selection into a separate dataset and display it in</span>
<span class="source-line-no">973</span><span id="line.973">        // a separate spreadsheet</span>
<span class="source-line-no">974</span><span id="line.974"></span>
<span class="source-line-no">975</span><span id="line.975">        while (st.hasMoreTokens()) {</span>
<span class="source-line-no">976</span><span id="line.976">            try {</span>
<span class="source-line-no">977</span><span id="line.977">                dsetCopy = constructor.newInstance(paramObj);</span>
<span class="source-line-no">978</span><span id="line.978">            }</span>
<span class="source-line-no">979</span><span id="line.979">            catch (Exception ex) {</span>
<span class="source-line-no">980</span><span id="line.980">                log.debug("showRegRefData(): constructor newInstance failure: ", ex);</span>
<span class="source-line-no">981</span><span id="line.981">                continue;</span>
<span class="source-line-no">982</span><span id="line.982">            }</span>
<span class="source-line-no">983</span><span id="line.983"></span>
<span class="source-line-no">984</span><span id="line.984">            if (dsetCopy == null) {</span>
<span class="source-line-no">985</span><span id="line.985">                log.debug("showRegRefData(): continue after null dataset copy");</span>
<span class="source-line-no">986</span><span id="line.986">                continue;</span>
<span class="source-line-no">987</span><span id="line.987">            }</span>
<span class="source-line-no">988</span><span id="line.988"></span>
<span class="source-line-no">989</span><span id="line.989">            try {</span>
<span class="source-line-no">990</span><span id="line.990">                dsetCopy.init();</span>
<span class="source-line-no">991</span><span id="line.991">            }</span>
<span class="source-line-no">992</span><span id="line.992">            catch (Exception ex) {</span>
<span class="source-line-no">993</span><span id="line.993">                log.debug("showRegRefData(): continue after copied dataset init failure: ", ex);</span>
<span class="source-line-no">994</span><span id="line.994">                continue;</span>
<span class="source-line-no">995</span><span id="line.995">            }</span>
<span class="source-line-no">996</span><span id="line.996"></span>
<span class="source-line-no">997</span><span id="line.997">            dsetCopy.getRank();</span>
<span class="source-line-no">998</span><span id="line.998">            long[] start = dsetCopy.getStartDims();</span>
<span class="source-line-no">999</span><span id="line.999">            long[] count = dsetCopy.getSelectedDims();</span>
<span class="source-line-no">1000</span><span id="line.1000"></span>
<span class="source-line-no">1001</span><span id="line.1001">            // set the selected dimension sizes based on the region selection</span>
<span class="source-line-no">1002</span><span id="line.1002">            // info.</span>
<span class="source-line-no">1003</span><span id="line.1003">            int idx = 0;</span>
<span class="source-line-no">1004</span><span id="line.1004">            String sizeStr = null;</span>
<span class="source-line-no">1005</span><span id="line.1005">            String token = st.nextToken();</span>
<span class="source-line-no">1006</span><span id="line.1006"></span>
<span class="source-line-no">1007</span><span id="line.1007">            token = token.replace('(', ' ');</span>
<span class="source-line-no">1008</span><span id="line.1008">            token = token.replace(')', ' ');</span>
<span class="source-line-no">1009</span><span id="line.1009">            if (isPointSelection) {</span>
<span class="source-line-no">1010</span><span id="line.1010">                // point selection</span>
<span class="source-line-no">1011</span><span id="line.1011">                StringTokenizer tmp = new StringTokenizer(token, ",");</span>
<span class="source-line-no">1012</span><span id="line.1012">                while (tmp.hasMoreTokens()) {</span>
<span class="source-line-no">1013</span><span id="line.1013">                    count[idx] = 1;</span>
<span class="source-line-no">1014</span><span id="line.1014">                    sizeStr = tmp.nextToken().trim();</span>
<span class="source-line-no">1015</span><span id="line.1015">                    start[idx] = Long.valueOf(sizeStr);</span>
<span class="source-line-no">1016</span><span id="line.1016">                    idx++;</span>
<span class="source-line-no">1017</span><span id="line.1017">                }</span>
<span class="source-line-no">1018</span><span id="line.1018">            }</span>
<span class="source-line-no">1019</span><span id="line.1019">            else {</span>
<span class="source-line-no">1020</span><span id="line.1020">                // rectangle selection</span>
<span class="source-line-no">1021</span><span id="line.1021">                String startStr = token.substring(0, token.indexOf('-'));</span>
<span class="source-line-no">1022</span><span id="line.1022">                String endStr = token.substring(token.indexOf('-') + 1);</span>
<span class="source-line-no">1023</span><span id="line.1023">                StringTokenizer tmp = new StringTokenizer(startStr, ",");</span>
<span class="source-line-no">1024</span><span id="line.1024">                while (tmp.hasMoreTokens()) {</span>
<span class="source-line-no">1025</span><span id="line.1025">                    sizeStr = tmp.nextToken().trim();</span>
<span class="source-line-no">1026</span><span id="line.1026">                    start[idx] = Long.valueOf(sizeStr);</span>
<span class="source-line-no">1027</span><span id="line.1027">                    idx++;</span>
<span class="source-line-no">1028</span><span id="line.1028">                }</span>
<span class="source-line-no">1029</span><span id="line.1029"></span>
<span class="source-line-no">1030</span><span id="line.1030">                idx = 0;</span>
<span class="source-line-no">1031</span><span id="line.1031">                tmp = new StringTokenizer(endStr, ",");</span>
<span class="source-line-no">1032</span><span id="line.1032">                while (tmp.hasMoreTokens()) {</span>
<span class="source-line-no">1033</span><span id="line.1033">                    sizeStr = tmp.nextToken().trim();</span>
<span class="source-line-no">1034</span><span id="line.1034">                    count[idx] = Long.valueOf(sizeStr) - start[idx] + 1;</span>
<span class="source-line-no">1035</span><span id="line.1035">                    idx++;</span>
<span class="source-line-no">1036</span><span id="line.1036">                }</span>
<span class="source-line-no">1037</span><span id="line.1037">            }</span>
<span class="source-line-no">1038</span><span id="line.1038"></span>
<span class="source-line-no">1039</span><span id="line.1039">            try {</span>
<span class="source-line-no">1040</span><span id="line.1040">                dsetCopy.getData();</span>
<span class="source-line-no">1041</span><span id="line.1041">            }</span>
<span class="source-line-no">1042</span><span id="line.1042">            catch (Exception ex) {</span>
<span class="source-line-no">1043</span><span id="line.1043">                log.debug("showRegRefData(): getData failure: ", ex);</span>
<span class="source-line-no">1044</span><span id="line.1044">                Tools.showError(shell, "Select", "Region Reference: " + ex.getMessage());</span>
<span class="source-line-no">1045</span><span id="line.1045">            }</span>
<span class="source-line-no">1046</span><span id="line.1046"></span>
<span class="source-line-no">1047</span><span id="line.1047">            Class&lt;?&gt; theClass = null;</span>
<span class="source-line-no">1048</span><span id="line.1048">            String viewName = null;</span>
<span class="source-line-no">1049</span><span id="line.1049"></span>
<span class="source-line-no">1050</span><span id="line.1050">            switch (viewType) {</span>
<span class="source-line-no">1051</span><span id="line.1051">                case IMAGE:</span>
<span class="source-line-no">1052</span><span id="line.1052">                    viewName = HDFView.getListOfImageViews().get(0);</span>
<span class="source-line-no">1053</span><span id="line.1053">                    break;</span>
<span class="source-line-no">1054</span><span id="line.1054">                case TABLE:</span>
<span class="source-line-no">1055</span><span id="line.1055">                    viewName = (String) HDFView.getListOfTableViews().get(0);</span>
<span class="source-line-no">1056</span><span id="line.1056">                    break;</span>
<span class="source-line-no">1057</span><span id="line.1057">                default:</span>
<span class="source-line-no">1058</span><span id="line.1058">                    viewName = null;</span>
<span class="source-line-no">1059</span><span id="line.1059">            }</span>
<span class="source-line-no">1060</span><span id="line.1060"></span>
<span class="source-line-no">1061</span><span id="line.1061">            try {</span>
<span class="source-line-no">1062</span><span id="line.1062">                theClass = Class.forName(viewName);</span>
<span class="source-line-no">1063</span><span id="line.1063">            }</span>
<span class="source-line-no">1064</span><span id="line.1064">            catch (Exception ex) {</span>
<span class="source-line-no">1065</span><span id="line.1065">                try {</span>
<span class="source-line-no">1066</span><span id="line.1066">                    theClass = ViewProperties.loadExtClass().loadClass(viewName);</span>
<span class="source-line-no">1067</span><span id="line.1067">                }</span>
<span class="source-line-no">1068</span><span id="line.1068">                catch (Exception ex2) {</span>
<span class="source-line-no">1069</span><span id="line.1069">                    theClass = null;</span>
<span class="source-line-no">1070</span><span id="line.1070">                }</span>
<span class="source-line-no">1071</span><span id="line.1071">            }</span>
<span class="source-line-no">1072</span><span id="line.1072"></span>
<span class="source-line-no">1073</span><span id="line.1073">            // Use default dataview</span>
<span class="source-line-no">1074</span><span id="line.1074">            if (theClass == null) {</span>
<span class="source-line-no">1075</span><span id="line.1075">                switch (viewType) {</span>
<span class="source-line-no">1076</span><span id="line.1076">                    case IMAGE:</span>
<span class="source-line-no">1077</span><span id="line.1077">                        viewName = ViewProperties.DEFAULT_IMAGEVIEW_NAME;</span>
<span class="source-line-no">1078</span><span id="line.1078">                        break;</span>
<span class="source-line-no">1079</span><span id="line.1079">                    case TABLE:</span>
<span class="source-line-no">1080</span><span id="line.1080">                        viewName = ViewProperties.DEFAULT_SCALAR_DATASET_TABLEVIEW_NAME;</span>
<span class="source-line-no">1081</span><span id="line.1081">                        break;</span>
<span class="source-line-no">1082</span><span id="line.1082">                    default:</span>
<span class="source-line-no">1083</span><span id="line.1083">                        viewName = null;</span>
<span class="source-line-no">1084</span><span id="line.1084">                }</span>
<span class="source-line-no">1085</span><span id="line.1085"></span>
<span class="source-line-no">1086</span><span id="line.1086">                try {</span>
<span class="source-line-no">1087</span><span id="line.1087">                    theClass = Class.forName(viewName);</span>
<span class="source-line-no">1088</span><span id="line.1088">                }</span>
<span class="source-line-no">1089</span><span id="line.1089">                catch (Exception ex) {</span>
<span class="source-line-no">1090</span><span id="line.1090">                    log.debug("showRegRefData(): no suitable display class found");</span>
<span class="source-line-no">1091</span><span id="line.1091">                    Tools.showError(shell, "Select", "Could not show reference data: no suitable display class found");</span>
<span class="source-line-no">1092</span><span id="line.1092">                    return;</span>
<span class="source-line-no">1093</span><span id="line.1093">                }</span>
<span class="source-line-no">1094</span><span id="line.1094">            }</span>
<span class="source-line-no">1095</span><span id="line.1095"></span>
<span class="source-line-no">1096</span><span id="line.1096">            HashMap map = new HashMap(1);</span>
<span class="source-line-no">1097</span><span id="line.1097">            map.put(ViewProperties.DATA_VIEW_KEY.OBJECT, dsetCopy);</span>
<span class="source-line-no">1098</span><span id="line.1098">            Object[] args = { viewer, map };</span>
<span class="source-line-no">1099</span><span id="line.1099"></span>
<span class="source-line-no">1100</span><span id="line.1100">            try {</span>
<span class="source-line-no">1101</span><span id="line.1101">                Tools.newInstance(theClass, args);</span>
<span class="source-line-no">1102</span><span id="line.1102">            }</span>
<span class="source-line-no">1103</span><span id="line.1103">            catch (Exception ex) {</span>
<span class="source-line-no">1104</span><span id="line.1104">                log.debug("showRegRefData(): Could not show reference data: ", ex);</span>
<span class="source-line-no">1105</span><span id="line.1105">                Tools.showError(shell, "Select", "Could not show reference data: " + ex.toString());</span>
<span class="source-line-no">1106</span><span id="line.1106">            }</span>
<span class="source-line-no">1107</span><span id="line.1107">        } // (st.hasMoreTokens())</span>
<span class="source-line-no">1108</span><span id="line.1108">    } // end of showRegRefData(String reg)</span>
<span class="source-line-no">1109</span><span id="line.1109"></span>
<span class="source-line-no">1110</span><span id="line.1110">    /**</span>
<span class="source-line-no">1111</span><span id="line.1111">     * Update cell value label and cell value field when a cell is selected</span>
<span class="source-line-no">1112</span><span id="line.1112">     */</span>
<span class="source-line-no">1113</span><span id="line.1113">    private class ScalarDSCellSelectionListener implements ILayerListener {</span>
<span class="source-line-no">1114</span><span id="line.1114">        @Override</span>
<span class="source-line-no">1115</span><span id="line.1115">        public void handleLayerEvent(ILayerEvent e) {</span>
<span class="source-line-no">1116</span><span id="line.1116">            if (e instanceof CellSelectionEvent) {</span>
<span class="source-line-no">1117</span><span id="line.1117">                log.trace("ScalarDSCellSelectionListener: CellSelected isRegRef={} isObjRef={}", isRegRef, isObjRef);</span>
<span class="source-line-no">1118</span><span id="line.1118"></span>
<span class="source-line-no">1119</span><span id="line.1119">                CellSelectionEvent event = (CellSelectionEvent) e;</span>
<span class="source-line-no">1120</span><span id="line.1120">                Object val = dataTable.getDataValueByPosition(event.getColumnPosition(), event.getRowPosition());</span>
<span class="source-line-no">1121</span><span id="line.1121">                String strVal = null;</span>
<span class="source-line-no">1122</span><span id="line.1122"></span>
<span class="source-line-no">1123</span><span id="line.1123">                String[] columnNames = ((ScalarDSColumnHeaderDataProvider) columnHeaderDataProvider).columnNames;</span>
<span class="source-line-no">1124</span><span id="line.1124">                int rowStart = ((RowHeaderDataProvider) rowHeaderDataProvider).start;</span>
<span class="source-line-no">1125</span><span id="line.1125">                int rowStride = ((RowHeaderDataProvider) rowHeaderDataProvider).stride;</span>
<span class="source-line-no">1126</span><span id="line.1126"></span>
<span class="source-line-no">1127</span><span id="line.1127">                cellLabel.setText(String.valueOf(</span>
<span class="source-line-no">1128</span><span id="line.1128">                        rowStart + indexBase + dataTable.getRowIndexByPosition(event.getRowPosition()) * rowStride)</span>
<span class="source-line-no">1129</span><span id="line.1129">                        + ", " + columnNames[dataTable.getColumnIndexByPosition(event.getColumnPosition())] + "  =  ");</span>
<span class="source-line-no">1130</span><span id="line.1130"></span>
<span class="source-line-no">1131</span><span id="line.1131">                if (val == null) {</span>
<span class="source-line-no">1132</span><span id="line.1132">                    cellValueField.setText("Null");</span>
<span class="source-line-no">1133</span><span id="line.1133">                    ((ScrolledComposite) cellValueField.getParent()).setMinSize(cellValueField.computeSize(SWT.DEFAULT, SWT.DEFAULT));</span>
<span class="source-line-no">1134</span><span id="line.1134">                    return;</span>
<span class="source-line-no">1135</span><span id="line.1135">                }</span>
<span class="source-line-no">1136</span><span id="line.1136"></span>
<span class="source-line-no">1137</span><span id="line.1137">                if (isRegRef) {</span>
<span class="source-line-no">1138</span><span id="line.1138">                    boolean displayValues = ViewProperties.showRegRefValues();</span>
<span class="source-line-no">1139</span><span id="line.1139"></span>
<span class="source-line-no">1140</span><span id="line.1140">                    log.trace("ScalarDSCellSelectionListener:RegRef CellSelected displayValues={}", displayValues);</span>
<span class="source-line-no">1141</span><span id="line.1141">                    if (displayValues &amp;&amp; val != null &amp;&amp; ((String) val).compareTo("NULL") != 0) {</span>
<span class="source-line-no">1142</span><span id="line.1142">                        String reg = (String) val;</span>
<span class="source-line-no">1143</span><span id="line.1143">                        boolean isPointSelection = (reg.indexOf('-') &lt;= 0);</span>
<span class="source-line-no">1144</span><span id="line.1144"></span>
<span class="source-line-no">1145</span><span id="line.1145">                        // find the object location</span>
<span class="source-line-no">1146</span><span id="line.1146">                        String oidStr = reg.substring(reg.indexOf('/'), reg.indexOf(' '));</span>
<span class="source-line-no">1147</span><span id="line.1147">                        log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: isPointSelection={} oidStr={}",</span>
<span class="source-line-no">1148</span><span id="line.1148">                                isPointSelection, oidStr);</span>
<span class="source-line-no">1149</span><span id="line.1149"></span>
<span class="source-line-no">1150</span><span id="line.1150">                        // decode the region selection</span>
<span class="source-line-no">1151</span><span id="line.1151">                        String regStr = reg.substring(reg.indexOf('{') + 1, reg.indexOf('}'));</span>
<span class="source-line-no">1152</span><span id="line.1152"></span>
<span class="source-line-no">1153</span><span id="line.1153">                        // no selection</span>
<span class="source-line-no">1154</span><span id="line.1154">                        if (regStr == null || regStr.length() &lt;= 0) {</span>
<span class="source-line-no">1155</span><span id="line.1155">                            log.debug("ScalarDSCellSelectionListener:RegRef CellSelected: no selection made");</span>
<span class="source-line-no">1156</span><span id="line.1156">                            strVal = null;</span>
<span class="source-line-no">1157</span><span id="line.1157">                        }</span>
<span class="source-line-no">1158</span><span id="line.1158">                        else {</span>
<span class="source-line-no">1159</span><span id="line.1159">                            // TODO: do we need to do something with what's past the closing bracket</span>
<span class="source-line-no">1160</span><span id="line.1160">                            // regStr = reg.substring(reg.indexOf('}') + 1);</span>
<span class="source-line-no">1161</span><span id="line.1161"></span>
<span class="source-line-no">1162</span><span id="line.1162">                            StringTokenizer st = new StringTokenizer(regStr);</span>
<span class="source-line-no">1163</span><span id="line.1163">                            int nSelections = st.countTokens();</span>
<span class="source-line-no">1164</span><span id="line.1164">                            if (nSelections &lt;= 0) { // no selection</span>
<span class="source-line-no">1165</span><span id="line.1165">                                strVal = null;</span>
<span class="source-line-no">1166</span><span id="line.1166">                            }</span>
<span class="source-line-no">1167</span><span id="line.1167">                            else {</span>
<span class="source-line-no">1168</span><span id="line.1168">                                log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: nSelections={}", nSelections);</span>
<span class="source-line-no">1169</span><span id="line.1169"></span>
<span class="source-line-no">1170</span><span id="line.1170">                                HObject obj = FileFormat.findObject(((HObject) dataObject).getFileFormat(), oidStr);</span>
<span class="source-line-no">1171</span><span id="line.1171">                                if (obj == null || !(obj instanceof ScalarDS)) { // no selection</span>
<span class="source-line-no">1172</span><span id="line.1172">                                    strVal = null;</span>
<span class="source-line-no">1173</span><span id="line.1173">                                }</span>
<span class="source-line-no">1174</span><span id="line.1174">                                else {</span>
<span class="source-line-no">1175</span><span id="line.1175">                                    ScalarDS dset = (ScalarDS) obj;</span>
<span class="source-line-no">1176</span><span id="line.1176">                                    try {</span>
<span class="source-line-no">1177</span><span id="line.1177">                                        dset.init();</span>
<span class="source-line-no">1178</span><span id="line.1178">                                    }</span>
<span class="source-line-no">1179</span><span id="line.1179">                                    catch (Exception ex) {</span>
<span class="source-line-no">1180</span><span id="line.1180">                                        log.debug("ScalarDSCellSelectionListener:RegRef CellSelected: reference dset did not init()", ex);</span>
<span class="source-line-no">1181</span><span id="line.1181">                                    }</span>
<span class="source-line-no">1182</span><span id="line.1182">                                    StringBuilder strvalSB = new StringBuilder();</span>
<span class="source-line-no">1183</span><span id="line.1183"></span>
<span class="source-line-no">1184</span><span id="line.1184">                                    int idx = 0;</span>
<span class="source-line-no">1185</span><span id="line.1185">                                    while (st.hasMoreTokens()) {</span>
<span class="source-line-no">1186</span><span id="line.1186">                                        int rank = dset.getRank();</span>
<span class="source-line-no">1187</span><span id="line.1187">                                        long[] start = dset.getStartDims();</span>
<span class="source-line-no">1188</span><span id="line.1188">                                        long[] count = dset.getSelectedDims();</span>
<span class="source-line-no">1189</span><span id="line.1189">                                        // long count[] = new long[rank];</span>
<span class="source-line-no">1190</span><span id="line.1190"></span>
<span class="source-line-no">1191</span><span id="line.1191">                                        // set the selected dimension sizes</span>
<span class="source-line-no">1192</span><span id="line.1192">                                        // based on the region selection</span>
<span class="source-line-no">1193</span><span id="line.1193">                                        // info.</span>
<span class="source-line-no">1194</span><span id="line.1194">                                        String sizeStr = null;</span>
<span class="source-line-no">1195</span><span id="line.1195">                                        String token = st.nextToken();</span>
<span class="source-line-no">1196</span><span id="line.1196"></span>
<span class="source-line-no">1197</span><span id="line.1197">                                        token = token.replace('(', ' ');</span>
<span class="source-line-no">1198</span><span id="line.1198">                                        token = token.replace(')', ' ');</span>
<span class="source-line-no">1199</span><span id="line.1199">                                        if (isPointSelection) {</span>
<span class="source-line-no">1200</span><span id="line.1200">                                            // point selection</span>
<span class="source-line-no">1201</span><span id="line.1201">                                            String[] tmp = token.split(",");</span>
<span class="source-line-no">1202</span><span id="line.1202">                                            for (int x = 0; x &lt; tmp.length; x++) {</span>
<span class="source-line-no">1203</span><span id="line.1203">                                                count[x] = 1;</span>
<span class="source-line-no">1204</span><span id="line.1204">                                                sizeStr = tmp[x].trim();</span>
<span class="source-line-no">1205</span><span id="line.1205">                                                start[x] = Long.valueOf(sizeStr);</span>
<span class="source-line-no">1206</span><span id="line.1206">                                                log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: point sel={}", tmp[x]);</span>
<span class="source-line-no">1207</span><span id="line.1207">                                            }</span>
<span class="source-line-no">1208</span><span id="line.1208">                                        }</span>
<span class="source-line-no">1209</span><span id="line.1209">                                        else {</span>
<span class="source-line-no">1210</span><span id="line.1210">                                            // rectangle selection</span>
<span class="source-line-no">1211</span><span id="line.1211">                                            String startStr = token.substring(0, token.indexOf('-'));</span>
<span class="source-line-no">1212</span><span id="line.1212">                                            String endStr = token.substring(token.indexOf('-') + 1);</span>
<span class="source-line-no">1213</span><span id="line.1213">                                            log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: rect sel with startStr={} endStr={}",</span>
<span class="source-line-no">1214</span><span id="line.1214">                                                    startStr, endStr);</span>
<span class="source-line-no">1215</span><span id="line.1215">                                            String[] tmp = startStr.split(",");</span>
<span class="source-line-no">1216</span><span id="line.1216">                                            log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: tmp with length={} rank={}",</span>
<span class="source-line-no">1217</span><span id="line.1217">                                                    tmp.length, rank);</span>
<span class="source-line-no">1218</span><span id="line.1218">                                            for (int x = 0; x &lt; tmp.length; x++) {</span>
<span class="source-line-no">1219</span><span id="line.1219">                                                sizeStr = tmp[x].trim();</span>
<span class="source-line-no">1220</span><span id="line.1220">                                                start[x] = Long.valueOf(sizeStr);</span>
<span class="source-line-no">1221</span><span id="line.1221">                                                log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: rect start={}",</span>
<span class="source-line-no">1222</span><span id="line.1222">                                                        tmp[x]);</span>
<span class="source-line-no">1223</span><span id="line.1223">                                            }</span>
<span class="source-line-no">1224</span><span id="line.1224">                                            tmp = endStr.split(",");</span>
<span class="source-line-no">1225</span><span id="line.1225">                                            for (int x = 0; x &lt; tmp.length; x++) {</span>
<span class="source-line-no">1226</span><span id="line.1226">                                                sizeStr = tmp[x].trim();</span>
<span class="source-line-no">1227</span><span id="line.1227">                                                count[x] = Long.valueOf(sizeStr) - start[x] + 1;</span>
<span class="source-line-no">1228</span><span id="line.1228">                                                log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: rect end={} count={}",</span>
<span class="source-line-no">1229</span><span id="line.1229">                                                        tmp[x], count[x]);</span>
<span class="source-line-no">1230</span><span id="line.1230">                                            }</span>
<span class="source-line-no">1231</span><span id="line.1231">                                        }</span>
<span class="source-line-no">1232</span><span id="line.1232"></span>
<span class="source-line-no">1233</span><span id="line.1233">                                        Object dbuf = null;</span>
<span class="source-line-no">1234</span><span id="line.1234">                                        try {</span>
<span class="source-line-no">1235</span><span id="line.1235">                                            dbuf = dset.getData();</span>
<span class="source-line-no">1236</span><span id="line.1236">                                        }</span>
<span class="source-line-no">1237</span><span id="line.1237">                                        catch (Exception ex) {</span>
<span class="source-line-no">1238</span><span id="line.1238">                                            Tools.showError(shell, "Select", "Region Reference:" +ex.getMessage());</span>
<span class="source-line-no">1239</span><span id="line.1239">                                        }</span>
<span class="source-line-no">1240</span><span id="line.1240"></span>
<span class="source-line-no">1241</span><span id="line.1241">                                        /* Convert dbuf to a displayable string */</span>
<span class="source-line-no">1242</span><span id="line.1242">                                        char runtimeTypeClass = Utils.getJavaObjectRuntimeClass(dbuf);</span>
<span class="source-line-no">1243</span><span id="line.1243">                                        log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: cName={} runtimeTypeClass={}",</span>
<span class="source-line-no">1244</span><span id="line.1244">                                                dbuf.getClass().getName(), runtimeTypeClass);</span>
<span class="source-line-no">1245</span><span id="line.1245"></span>
<span class="source-line-no">1246</span><span id="line.1246">                                        if (idx &gt; 0) strvalSB.append(',');</span>
<span class="source-line-no">1247</span><span id="line.1247"></span>
<span class="source-line-no">1248</span><span id="line.1248">                                        // convert numerical data into char</span>
<span class="source-line-no">1249</span><span id="line.1249">                                        // only possible cases are byte[]</span>
<span class="source-line-no">1250</span><span id="line.1250">                                        // and short[] (converted from</span>
<span class="source-line-no">1251</span><span id="line.1251">                                        // unsigned byte)</span>
<span class="source-line-no">1252</span><span id="line.1252">                                        Datatype dtype = dset.getDatatype();</span>
<span class="source-line-no">1253</span><span id="line.1253">                                        Datatype baseType = dtype.getDatatypeBase();</span>
<span class="source-line-no">1254</span><span id="line.1254">                                        log.trace("ScalarDSCellSelectionListener:RegRef CellSelected: dtype={} baseType={}",</span>
<span class="source-line-no">1255</span><span id="line.1255">                                                dtype.getDescription(), baseType);</span>
<span class="source-line-no">1256</span><span id="line.1256">                                        if (baseType == null)</span>
<span class="source-line-no">1257</span><span id="line.1257">                                            baseType = dtype;</span>
<span class="source-line-no">1258</span><span id="line.1258">                                        if ((dtype.isArray() &amp;&amp; baseType.isChar())</span>
<span class="source-line-no">1259</span><span id="line.1259">                                                &amp;&amp; ((runtimeTypeClass == 'B') || (runtimeTypeClass == 'S'))) {</span>
<span class="source-line-no">1260</span><span id="line.1260">                                            int n = Array.getLength(dbuf);</span>
<span class="source-line-no">1261</span><span id="line.1261">                                            log.trace("ScalarDSCellSelectionListener:RegRef CellSelected charData length = {}", n);</span>
<span class="source-line-no">1262</span><span id="line.1262">                                            char[] charData = new char[n];</span>
<span class="source-line-no">1263</span><span id="line.1263">                                            for (int i = 0; i &lt; n; i++) {</span>
<span class="source-line-no">1264</span><span id="line.1264">                                                if (runtimeTypeClass == 'B') {</span>
<span class="source-line-no">1265</span><span id="line.1265">                                                    charData[i] = (char) Array.getByte(dbuf, i);</span>
<span class="source-line-no">1266</span><span id="line.1266">                                                }</span>
<span class="source-line-no">1267</span><span id="line.1267">                                                else if (runtimeTypeClass == 'S') {</span>
<span class="source-line-no">1268</span><span id="line.1268">                                                    charData[i] = (char) Array.getShort(dbuf, i);</span>
<span class="source-line-no">1269</span><span id="line.1269">                                                }</span>
<span class="source-line-no">1270</span><span id="line.1270">                                            }</span>
<span class="source-line-no">1271</span><span id="line.1271"></span>
<span class="source-line-no">1272</span><span id="line.1272">                                            strvalSB.append(charData);</span>
<span class="source-line-no">1273</span><span id="line.1273">                                        }</span>
<span class="source-line-no">1274</span><span id="line.1274">                                        else {</span>
<span class="source-line-no">1275</span><span id="line.1275">                                            // numerical values</span>
<span class="source-line-no">1276</span><span id="line.1276">                                            boolean isUnsigned = dtype.isUnsigned();</span>
<span class="source-line-no">1277</span><span id="line.1277">                                            if (dtype.isArray())</span>
<span class="source-line-no">1278</span><span id="line.1278">                                                isUnsigned = baseType.isUnsigned();</span>
<span class="source-line-no">1279</span><span id="line.1279">                                            int n = Array.getLength(dbuf);</span>
<span class="source-line-no">1280</span><span id="line.1280">                                            if (isUnsigned) {</span>
<span class="source-line-no">1281</span><span id="line.1281">                                                switch (runtimeTypeClass) {</span>
<span class="source-line-no">1282</span><span id="line.1282">                                                    case 'B':</span>
<span class="source-line-no">1283</span><span id="line.1283">                                                        byte[] barray = (byte[]) dbuf;</span>
<span class="source-line-no">1284</span><span id="line.1284">                                                        short sValue = barray[0];</span>
<span class="source-line-no">1285</span><span id="line.1285">                                                        if (sValue &lt; 0) {</span>
<span class="source-line-no">1286</span><span id="line.1286">                                                            sValue += 256;</span>
<span class="source-line-no">1287</span><span id="line.1287">                                                        }</span>
<span class="source-line-no">1288</span><span id="line.1288">                                                        strvalSB.append(sValue);</span>
<span class="source-line-no">1289</span><span id="line.1289">                                                        for (int i = 1; i &lt; n; i++) {</span>
<span class="source-line-no">1290</span><span id="line.1290">                                                            strvalSB.append(',');</span>
<span class="source-line-no">1291</span><span id="line.1291">                                                            sValue = barray[i];</span>
<span class="source-line-no">1292</span><span id="line.1292">                                                            if (sValue &lt; 0) {</span>
<span class="source-line-no">1293</span><span id="line.1293">                                                                sValue += 256;</span>
<span class="source-line-no">1294</span><span id="line.1294">                                                            }</span>
<span class="source-line-no">1295</span><span id="line.1295">                                                            strvalSB.append(sValue);</span>
<span class="source-line-no">1296</span><span id="line.1296">                                                        }</span>
<span class="source-line-no">1297</span><span id="line.1297">                                                        break;</span>
<span class="source-line-no">1298</span><span id="line.1298">                                                    case 'S':</span>
<span class="source-line-no">1299</span><span id="line.1299">                                                        short[] sarray = (short[]) dbuf;</span>
<span class="source-line-no">1300</span><span id="line.1300">                                                        int iValue = sarray[0];</span>
<span class="source-line-no">1301</span><span id="line.1301">                                                        if (iValue &lt; 0) {</span>
<span class="source-line-no">1302</span><span id="line.1302">                                                            iValue += 65536;</span>
<span class="source-line-no">1303</span><span id="line.1303">                                                        }</span>
<span class="source-line-no">1304</span><span id="line.1304">                                                        strvalSB.append(iValue);</span>
<span class="source-line-no">1305</span><span id="line.1305">                                                        for (int i = 1; i &lt; n; i++) {</span>
<span class="source-line-no">1306</span><span id="line.1306">                                                            strvalSB.append(',');</span>
<span class="source-line-no">1307</span><span id="line.1307">                                                            iValue = sarray[i];</span>
<span class="source-line-no">1308</span><span id="line.1308">                                                            if (iValue &lt; 0) {</span>
<span class="source-line-no">1309</span><span id="line.1309">                                                                iValue += 65536;</span>
<span class="source-line-no">1310</span><span id="line.1310">                                                            }</span>
<span class="source-line-no">1311</span><span id="line.1311">                                                            strvalSB.append(iValue);</span>
<span class="source-line-no">1312</span><span id="line.1312">                                                        }</span>
<span class="source-line-no">1313</span><span id="line.1313">                                                        break;</span>
<span class="source-line-no">1314</span><span id="line.1314">                                                    case 'I':</span>
<span class="source-line-no">1315</span><span id="line.1315">                                                        int[] iarray = (int[]) dbuf;</span>
<span class="source-line-no">1316</span><span id="line.1316">                                                        long lValue = iarray[0];</span>
<span class="source-line-no">1317</span><span id="line.1317">                                                        if (lValue &lt; 0) {</span>
<span class="source-line-no">1318</span><span id="line.1318">                                                            lValue += 4294967296L;</span>
<span class="source-line-no">1319</span><span id="line.1319">                                                        }</span>
<span class="source-line-no">1320</span><span id="line.1320">                                                        strvalSB.append(lValue);</span>
<span class="source-line-no">1321</span><span id="line.1321">                                                        for (int i = 1; i &lt; n; i++) {</span>
<span class="source-line-no">1322</span><span id="line.1322">                                                            strvalSB.append(',');</span>
<span class="source-line-no">1323</span><span id="line.1323">                                                            lValue = iarray[i];</span>
<span class="source-line-no">1324</span><span id="line.1324">                                                            if (lValue &lt; 0) {</span>
<span class="source-line-no">1325</span><span id="line.1325">                                                                lValue += 4294967296L;</span>
<span class="source-line-no">1326</span><span id="line.1326">                                                            }</span>
<span class="source-line-no">1327</span><span id="line.1327">                                                            strvalSB.append(lValue);</span>
<span class="source-line-no">1328</span><span id="line.1328">                                                        }</span>
<span class="source-line-no">1329</span><span id="line.1329">                                                        break;</span>
<span class="source-line-no">1330</span><span id="line.1330">                                                    case 'J':</span>
<span class="source-line-no">1331</span><span id="line.1331">                                                        long[] larray = (long[]) dbuf;</span>
<span class="source-line-no">1332</span><span id="line.1332">                                                        Long l = larray[0];</span>
<span class="source-line-no">1333</span><span id="line.1333">                                                        String theValue = Long.toString(l);</span>
<span class="source-line-no">1334</span><span id="line.1334">                                                        if (l &lt; 0) {</span>
<span class="source-line-no">1335</span><span id="line.1335">                                                            l = (l &lt;&lt; 1) &gt;&gt;&gt; 1;</span>
<span class="source-line-no">1336</span><span id="line.1336">                                                            BigInteger big1 = new BigInteger("9223372036854775808"); // 2^65</span>
<span class="source-line-no">1337</span><span id="line.1337">                                                            BigInteger big2 = new BigInteger(l.toString());</span>
<span class="source-line-no">1338</span><span id="line.1338">                                                            BigInteger big = big1.add(big2);</span>
<span class="source-line-no">1339</span><span id="line.1339">                                                            theValue = big.toString();</span>
<span class="source-line-no">1340</span><span id="line.1340">                                                        }</span>
<span class="source-line-no">1341</span><span id="line.1341">                                                        strvalSB.append(theValue);</span>
<span class="source-line-no">1342</span><span id="line.1342">                                                        for (int i = 1; i &lt; n; i++) {</span>
<span class="source-line-no">1343</span><span id="line.1343">                                                            strvalSB.append(',');</span>
<span class="source-line-no">1344</span><span id="line.1344">                                                            l = larray[i];</span>
<span class="source-line-no">1345</span><span id="line.1345">                                                            theValue = Long.toString(l);</span>
<span class="source-line-no">1346</span><span id="line.1346">                                                            if (l &lt; 0) {</span>
<span class="source-line-no">1347</span><span id="line.1347">                                                                l = (l &lt;&lt; 1) &gt;&gt;&gt; 1;</span>
<span class="source-line-no">1348</span><span id="line.1348">                                                                BigInteger big1 = new BigInteger("9223372036854775808"); // 2^65</span>
<span class="source-line-no">1349</span><span id="line.1349">                                                                BigInteger big2 = new BigInteger(l.toString());</span>
<span class="source-line-no">1350</span><span id="line.1350">                                                                BigInteger big = big1.add(big2);</span>
<span class="source-line-no">1351</span><span id="line.1351">                                                                theValue = big.toString();</span>
<span class="source-line-no">1352</span><span id="line.1352">                                                            }</span>
<span class="source-line-no">1353</span><span id="line.1353">                                                            strvalSB.append(theValue);</span>
<span class="source-line-no">1354</span><span id="line.1354">                                                        }</span>
<span class="source-line-no">1355</span><span id="line.1355">                                                        break;</span>
<span class="source-line-no">1356</span><span id="line.1356">                                                    default:</span>
<span class="source-line-no">1357</span><span id="line.1357">                                                        strvalSB.append(Array.get(dbuf, 0));</span>
<span class="source-line-no">1358</span><span id="line.1358">                                                        for (int i = 1; i &lt; n; i++) {</span>
<span class="source-line-no">1359</span><span id="line.1359">                                                            strvalSB.append(',');</span>
<span class="source-line-no">1360</span><span id="line.1360">                                                            strvalSB.append(Array.get(dbuf, i));</span>
<span class="source-line-no">1361</span><span id="line.1361">                                                        }</span>
<span class="source-line-no">1362</span><span id="line.1362">                                                        break;</span>
<span class="source-line-no">1363</span><span id="line.1363">                                                }</span>
<span class="source-line-no">1364</span><span id="line.1364">                                            }</span>
<span class="source-line-no">1365</span><span id="line.1365">                                            else {</span>
<span class="source-line-no">1366</span><span id="line.1366">                                                for (int x = 0; x &lt; n; x++) {</span>
<span class="source-line-no">1367</span><span id="line.1367">                                                    Object theValue = Array.get(dbuf, x);</span>
<span class="source-line-no">1368</span><span id="line.1368">                                                    if (x &gt; 0) strvalSB.append(',');</span>
<span class="source-line-no">1369</span><span id="line.1369">                                                    strvalSB.append(theValue);</span>
<span class="source-line-no">1370</span><span id="line.1370">                                                }</span>
<span class="source-line-no">1371</span><span id="line.1371">                                            }</span>
<span class="source-line-no">1372</span><span id="line.1372">                                        }</span>
<span class="source-line-no">1373</span><span id="line.1373">                                        idx++;</span>
<span class="source-line-no">1374</span><span id="line.1374">                                        dset.clearData();</span>
<span class="source-line-no">1375</span><span id="line.1375">                                    } // (st.hasMoreTokens())</span>
<span class="source-line-no">1376</span><span id="line.1376">                                    strVal = strvalSB.toString();</span>
<span class="source-line-no">1377</span><span id="line.1377">                                }</span>
<span class="source-line-no">1378</span><span id="line.1378">                            }</span>
<span class="source-line-no">1379</span><span id="line.1379">                        }</span>
<span class="source-line-no">1380</span><span id="line.1380">                    }</span>
<span class="source-line-no">1381</span><span id="line.1381">                    else {</span>
<span class="source-line-no">1382</span><span id="line.1382">                        strVal = null;</span>
<span class="source-line-no">1383</span><span id="line.1383">                    }</span>
<span class="source-line-no">1384</span><span id="line.1384">                }</span>
<span class="source-line-no">1385</span><span id="line.1385">                else if (isObjRef) {</span>
<span class="source-line-no">1386</span><span id="line.1386">                    Long ref = (Long) val;</span>
<span class="source-line-no">1387</span><span id="line.1387">                    long[] oid = { ref.longValue() };</span>
<span class="source-line-no">1388</span><span id="line.1388"></span>
<span class="source-line-no">1389</span><span id="line.1389">                    // decode object ID</span>
<span class="source-line-no">1390</span><span id="line.1390">                    try {</span>
<span class="source-line-no">1391</span><span id="line.1391">                        HObject obj = FileFormat.findObject(((HObject) dataObject).getFileFormat(), oid);</span>
<span class="source-line-no">1392</span><span id="line.1392">                        strVal = obj.getFullName();</span>
<span class="source-line-no">1393</span><span id="line.1393">                    }</span>
<span class="source-line-no">1394</span><span id="line.1394">                    catch (Exception ex) {</span>
<span class="source-line-no">1395</span><span id="line.1395">                        strVal = null;</span>
<span class="source-line-no">1396</span><span id="line.1396">                    }</span>
<span class="source-line-no">1397</span><span id="line.1397">                }</span>
<span class="source-line-no">1398</span><span id="line.1398"></span>
<span class="source-line-no">1399</span><span id="line.1399">                if (strVal == null &amp;&amp; val != null)</span>
<span class="source-line-no">1400</span><span id="line.1400">                    strVal = dataDisplayConverter.canonicalToDisplayValue(val).toString();</span>
<span class="source-line-no">1401</span><span id="line.1401"></span>
<span class="source-line-no">1402</span><span id="line.1402">                cellValueField.setText(strVal);</span>
<span class="source-line-no">1403</span><span id="line.1403">                ((ScrolledComposite) cellValueField.getParent()).setMinSize(cellValueField.computeSize(SWT.DEFAULT, SWT.DEFAULT));</span>
<span class="source-line-no">1404</span><span id="line.1404">            }</span>
<span class="source-line-no">1405</span><span id="line.1405">        }</span>
<span class="source-line-no">1406</span><span id="line.1406">    }</span>
<span class="source-line-no">1407</span><span id="line.1407"></span>
<span class="source-line-no">1408</span><span id="line.1408">    /**</span>
<span class="source-line-no">1409</span><span id="line.1409">     * Custom Column Header data provider to set column indices based on Index Base</span>
<span class="source-line-no">1410</span><span id="line.1410">     * for Scalar Datasets.</span>
<span class="source-line-no">1411</span><span id="line.1411">     */</span>
<span class="source-line-no">1412</span><span id="line.1412">    private class ScalarDSColumnHeaderDataProvider implements IDataProvider {</span>
<span class="source-line-no">1413</span><span id="line.1413"></span>
<span class="source-line-no">1414</span><span id="line.1414">        private final String columnNames[];</span>
<span class="source-line-no">1415</span><span id="line.1415"></span>
<span class="source-line-no">1416</span><span id="line.1416">        private final int    rank;</span>
<span class="source-line-no">1417</span><span id="line.1417"></span>
<span class="source-line-no">1418</span><span id="line.1418">        private final long[] startArray;</span>
<span class="source-line-no">1419</span><span id="line.1419">        private final long[] strideArray;</span>
<span class="source-line-no">1420</span><span id="line.1420">        private final int[]  selectedIndex;</span>
<span class="source-line-no">1421</span><span id="line.1421"></span>
<span class="source-line-no">1422</span><span id="line.1422">        private final int    ncols;</span>
<span class="source-line-no">1423</span><span id="line.1423"></span>
<span class="source-line-no">1424</span><span id="line.1424">        public ScalarDSColumnHeaderDataProvider(DataFormat theDataObject) {</span>
<span class="source-line-no">1425</span><span id="line.1425">            rank = theDataObject.getRank();</span>
<span class="source-line-no">1426</span><span id="line.1426"></span>
<span class="source-line-no">1427</span><span id="line.1427">            startArray = theDataObject.getStartDims();</span>
<span class="source-line-no">1428</span><span id="line.1428">            strideArray = theDataObject.getStride();</span>
<span class="source-line-no">1429</span><span id="line.1429">            selectedIndex = theDataObject.getSelectedIndex();</span>
<span class="source-line-no">1430</span><span id="line.1430"></span>
<span class="source-line-no">1431</span><span id="line.1431">            if (rank &gt; 1) {</span>
<span class="source-line-no">1432</span><span id="line.1432">                ncols = (int) theDataObject.getWidth();</span>
<span class="source-line-no">1433</span><span id="line.1433"></span>
<span class="source-line-no">1434</span><span id="line.1434">                int start = (int) startArray[selectedIndex[1]];</span>
<span class="source-line-no">1435</span><span id="line.1435">                int stride = (int) strideArray[selectedIndex[1]];</span>
<span class="source-line-no">1436</span><span id="line.1436"></span>
<span class="source-line-no">1437</span><span id="line.1437">                columnNames = new String[ncols];</span>
<span class="source-line-no">1438</span><span id="line.1438"></span>
<span class="source-line-no">1439</span><span id="line.1439">                for (int i = 0; i &lt; ncols; i++) {</span>
<span class="source-line-no">1440</span><span id="line.1440">                    columnNames[i] = String.valueOf(start + indexBase + i * stride);</span>
<span class="source-line-no">1441</span><span id="line.1441">                }</span>
<span class="source-line-no">1442</span><span id="line.1442">            }</span>
<span class="source-line-no">1443</span><span id="line.1443">            else {</span>
<span class="source-line-no">1444</span><span id="line.1444">                ncols = 1;</span>
<span class="source-line-no">1445</span><span id="line.1445"></span>
<span class="source-line-no">1446</span><span id="line.1446">                columnNames = new String[] { "  " };</span>
<span class="source-line-no">1447</span><span id="line.1447">            }</span>
<span class="source-line-no">1448</span><span id="line.1448">        }</span>
<span class="source-line-no">1449</span><span id="line.1449"></span>
<span class="source-line-no">1450</span><span id="line.1450">        @Override</span>
<span class="source-line-no">1451</span><span id="line.1451">        public int getColumnCount() {</span>
<span class="source-line-no">1452</span><span id="line.1452">            return ncols;</span>
<span class="source-line-no">1453</span><span id="line.1453">        }</span>
<span class="source-line-no">1454</span><span id="line.1454"></span>
<span class="source-line-no">1455</span><span id="line.1455">        @Override</span>
<span class="source-line-no">1456</span><span id="line.1456">        public int getRowCount() {</span>
<span class="source-line-no">1457</span><span id="line.1457">            return 1;</span>
<span class="source-line-no">1458</span><span id="line.1458">        }</span>
<span class="source-line-no">1459</span><span id="line.1459"></span>
<span class="source-line-no">1460</span><span id="line.1460">        @Override</span>
<span class="source-line-no">1461</span><span id="line.1461">        public Object getDataValue(int columnIndex, int rowIndex) {</span>
<span class="source-line-no">1462</span><span id="line.1462">            return columnNames[columnIndex];</span>
<span class="source-line-no">1463</span><span id="line.1463">        }</span>
<span class="source-line-no">1464</span><span id="line.1464"></span>
<span class="source-line-no">1465</span><span id="line.1465">        @Override</span>
<span class="source-line-no">1466</span><span id="line.1466">        public void setDataValue(int columnIndex, int rowIndex, Object newValue) {</span>
<span class="source-line-no">1467</span><span id="line.1467">            // intentional</span>
<span class="source-line-no">1468</span><span id="line.1468">        }</span>
<span class="source-line-no">1469</span><span id="line.1469">    }</span>
<span class="source-line-no">1470</span><span id="line.1470">}</span>




























































</pre>
</div>
</main>
</body>
</html>
